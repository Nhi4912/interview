<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Networking &amp; HTTP Fundamentals for Frontend | Frontend Interview Preparation Guide</title>
    <meta name="description" content="Comprehensive frontend interview materials for Big Tech companies">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="container">
            <div class="logo">Frontend Interview Hub</div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span aria-hidden="true">â˜°</span>
            </button>
            <ul class="nav-links" role="navigation" aria-label="Main navigation">
                <li><a href="/">Home</a></li>
                <li><a href="#progress">Progress</a></li>
                <li><a href="#knowledge">Knowledge</a></li>
                <li><a href="https://github.com/nee/interview" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="content-container">
    
        <nav class="breadcrumb">
            <ol>
                <li><a href="/">Home</a></li>
                
                
                
                    
                
                    
                        
                        
                            <li><a href="/frontend/">Frontend</a></li>
                        
                    
                
                    
                        
                        
                            <li><a href="/frontend/fundamentals/">Fundamentals</a></li>
                        
                    
                
                    
                        
                        
                            <li class="active">Networking &amp; http fundamentals for frontend</li>
                        
                    
                
            </ol>
        </nav>
    
    
    <article class="content">
        
            <header class="content-header">
                <h1 class="content-title">Networking &amp; HTTP Fundamentals for Frontend</h1>
                
                
            </header>
        
        
        <div class="content-body">
            <h1 id="networking--http-fundamentals-for-frontend">Networking &amp; HTTP Fundamentals for Frontend</h1>

<h2 id="overview">Overview</h2>
<p>Understanding networking and HTTP protocols is crucial for building efficient, secure, and scalable frontend applications. This guide covers essential networking concepts with practical implementations.</p>

<hr />

<h2 id="http-protocol-deep-dive">HTTP Protocol Deep Dive</h2>

<h3 id="http-methods-and-semantic-usage"><strong>HTTP Methods and Semantic Usage</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
</pre></td><td class="rouge-code"><pre><span class="c1">// Comprehensive HTTP client with advanced features</span>
<span class="kd">class</span> <span class="nx">AdvancedHTTPClient</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">baseURL</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaders</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">||</span> <span class="mi">30000</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">retryConfig</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">retry</span> <span class="o">||</span> <span class="p">{</span> <span class="na">maxRetries</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">backoffFactor</span><span class="p">:</span> <span class="mi">2</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">interceptors</span> <span class="o">=</span> <span class="p">{</span> <span class="na">request</span><span class="p">:</span> <span class="p">[],</span> <span class="na">response</span><span class="p">:</span> <span class="p">[]</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// HTTP GET with caching and conditional requests</span>
  <span class="k">async</span> <span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cacheKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateCacheKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFromCache</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaders</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span>
    <span class="p">};</span>

    <span class="c1">// Add conditional headers if cached response exists</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">.</span><span class="nx">etag</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-None-Match</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cachedResponse</span><span class="p">.</span><span class="nx">etag</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">.</span><span class="nx">lastModified</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">If-Modified-Since</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cachedResponse</span><span class="p">.</span><span class="nx">lastModified</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="p">...</span><span class="nx">options</span><span class="p">,</span> <span class="nx">headers</span> <span class="p">});</span>
    
    <span class="c1">// Handle 304 Not Modified</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span> <span class="o">&amp;&amp;</span> <span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">cachedResponse</span><span class="p">,</span>
        <span class="na">fromCache</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">cacheHit</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// Cache successful responses</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setCache</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// HTTP POST with request deduplication</span>
  <span class="k">async</span> <span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">requestKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateRequestKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    
    <span class="c1">// Check for duplicate in-flight requests</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">requestKey</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Duplicate request in progress</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="p">...</span><span class="nx">options</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">data</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// HTTP PUT for idempotent updates</span>
  <span class="k">async</span> <span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">PUT</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="p">...</span><span class="nx">options</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">data</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// HTTP PATCH for partial updates</span>
  <span class="k">async</span> <span class="nx">patch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json-patch+json</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span>
    <span class="p">};</span>

    <span class="c1">// Support JSON Patch format</span>
    <span class="kd">const</span> <span class="nx">patchData</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">?</span> <span class="nx">data</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateJsonPatch</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">PATCH</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="p">{</span> 
      <span class="p">...</span><span class="nx">options</span><span class="p">,</span> 
      <span class="nx">headers</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">patchData</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// HTTP DELETE with confirmation</span>
  <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// HTTP HEAD for metadata only</span>
  <span class="k">async</span> <span class="nx">head</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">HEAD</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// HTTP OPTIONS for CORS preflight</span>
  <span class="k">async</span> <span class="nx">options</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">OPTIONS</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Core request method with comprehensive error handling</span>
  <span class="k">async</span> <span class="nx">request</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">requestId</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">fullURL</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolveURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    
    <span class="kd">let</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">lastError</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">attempt</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">retryConfig</span><span class="p">.</span><span class="nx">maxRetries</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AbortController</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">requestKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateRequestKey</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">requestKey</span><span class="p">,</span> <span class="nx">controller</span><span class="p">);</span>

        <span class="c1">// Apply request interceptors</span>
        <span class="kd">const</span> <span class="nx">processedOptions</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">applyRequestInterceptors</span><span class="p">({</span>
          <span class="nx">method</span><span class="p">,</span>
          <span class="na">url</span><span class="p">:</span> <span class="nx">fullURL</span><span class="p">,</span>
          <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
          <span class="na">signal</span><span class="p">:</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span>
        <span class="p">});</span>

        <span class="c1">// Set timeout</span>
        <span class="kd">const</span> <span class="nx">timeoutId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">fullURL</span><span class="p">,</span> <span class="nx">processedOptions</span><span class="p">);</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">requestKey</span><span class="p">);</span>

          <span class="c1">// Apply response interceptors</span>
          <span class="kd">const</span> <span class="nx">processedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">applyResponseInterceptors</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
          
          <span class="c1">// Handle HTTP errors</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">processedResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">HTTPError</span><span class="p">(</span><span class="nx">processedResponse</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseResponse</span><span class="p">(</span><span class="nx">processedResponse</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">requestKey</span><span class="p">);</span>
          <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="p">}</span>

      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lastError</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>
        
        <span class="c1">// Don't retry certain errors</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNonRetriableError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">||</span> <span class="nx">attempt</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">retryConfig</span><span class="p">.</span><span class="nx">maxRetries</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Wait before retry with exponential backoff</span>
        <span class="kd">const</span> <span class="nx">delay</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">retryConfig</span><span class="p">.</span><span class="nx">backoffFactor</span><span class="p">,</span> <span class="nx">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nx">delay</span><span class="p">);</span>
        <span class="nx">attempt</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">throw</span> <span class="nx">lastError</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Request/Response interceptors</span>
  <span class="nx">addRequestInterceptor</span><span class="p">(</span><span class="nx">interceptor</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">interceptor</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">addResponseInterceptor</span><span class="p">(</span><span class="nx">interceptor</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">interceptor</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">applyRequestInterceptors</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">processedConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">config</span> <span class="p">};</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">interceptor</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">processedConfig</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">interceptor</span><span class="p">(</span><span class="nx">processedConfig</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">processedConfig</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">applyResponseInterceptors</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">processedResponse</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">interceptor</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">processedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">interceptor</span><span class="p">(</span><span class="nx">processedResponse</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">processedResponse</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Advanced caching with TTL and size limits</span>
  <span class="nx">setCache</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="mi">300000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 5 minutes default</span>
    <span class="kd">const</span> <span class="nx">cacheEntry</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">response</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
      <span class="nx">ttl</span><span class="p">,</span>
      <span class="na">etag</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">etag</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">lastModified</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">last-modified</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">size</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">estimateResponseSize</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">cacheEntry</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">evictExpiredCache</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">enforceMaxCacheSize</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">getFromCache</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    
    <span class="c1">// Check if expired</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">evictExpiredCache</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">entry</span><span class="p">]</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">enforceMaxCacheSize</span><span class="p">(</span><span class="nx">maxSize</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 50MB default</span>
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">entries</span><span class="p">());</span>
    
    <span class="c1">// Calculate total cache size</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[,</span> <span class="nx">entry</span><span class="p">]</span> <span class="k">of</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">totalSize</span> <span class="o">&gt;</span> <span class="nx">maxSize</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Sort by access time (LRU eviction)</span>
      <span class="nx">entries</span><span class="p">.</span><span class="nx">sort</span><span class="p">(([,</span> <span class="nx">a</span><span class="p">],</span> <span class="p">[,</span> <span class="nx">b</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">);</span>
      
      <span class="c1">// Remove oldest entries until under limit</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">entry</span><span class="p">]</span> <span class="k">of</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="nx">totalSize</span> <span class="o">-=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">totalSize</span> <span class="o">&lt;=</span> <span class="nx">maxSize</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Utility methods</span>
  <span class="nx">generateCacheKey</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">keyData</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">method</span><span class="p">,</span>
      <span class="nx">url</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
      <span class="na">searchParams</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">searchParams</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">keyData</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">generateRequestKey</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">method</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">hashObject</span><span class="p">(</span><span class="nx">body</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">hashObject</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="k">return</span> <span class="dl">''</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">resolveURL</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">}${</span><span class="nx">url</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">generateJsonPatch</span><span class="p">(</span><span class="nx">changes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">patches</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">path</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">changes</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">patches</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">op</span><span class="p">:</span> <span class="dl">'</span><span class="s1">replace</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">path</span><span class="p">:</span> <span class="s2">`/</span><span class="p">${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
        <span class="nx">value</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">patches</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">estimateResponseSize</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">contentLength</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-length</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">contentLength</span> <span class="p">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">contentLength</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1024</span><span class="p">;</span> <span class="c1">// 1KB default estimate</span>
  <span class="p">}</span>

  <span class="nx">isNonRetriableError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">HTTPError</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
      <span class="c1">// Don't retry client errors (4xx) except 429 (Too Many Requests)</span>
      <span class="k">return</span> <span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span> <span class="o">!==</span> <span class="mi">429</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Don't retry abort errors</span>
    <span class="k">return</span> <span class="nx">error</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">AbortError</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">parseResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">contentType</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
      <span class="na">statusText</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">fromEntries</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">entries</span><span class="p">()),</span>
      <span class="na">ok</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">ok</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">application/octet-stream</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">arrayBuffer</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">blob</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">delay</span><span class="p">(</span><span class="nx">ms</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Cancel all pending requests</span>
  <span class="nx">cancelAllRequests</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">controller</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">abortControllers</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Clear cache</span>
  <span class="nx">clearCache</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Get cache statistics</span>
  <span class="nx">getCacheStats</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">expiredCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entry</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">expiredCount</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="na">totalEntries</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span>
      <span class="nx">totalSize</span><span class="p">,</span>
      <span class="na">expiredEntries</span><span class="p">:</span> <span class="nx">expiredCount</span><span class="p">,</span>
      <span class="na">hitRate</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateHitRate</span><span class="p">()</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">calculateHitRate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// This would need to be tracked separately in a real implementation</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Custom HTTP Error class</span>
<span class="kd">class</span> <span class="nx">HTTPError</span> <span class="kd">extends</span> <span class="nb">Error</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="s2">`HTTP </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">HTTPError</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">response</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="advanced-requestresponse-handling">Advanced Request/Response Handling</h2>

<h3 id="websocket-implementation-with-reconnection"><strong>WebSocket Implementation with Reconnection</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
</pre></td><td class="rouge-code"><pre><span class="c1">// Robust WebSocket client with advanced features</span>
<span class="kd">class</span> <span class="nx">AdvancedWebSocket</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">protocols</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">protocols</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">maxReconnectAttempts</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxReconnectAttempts</span> <span class="o">||</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectDelay</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reconnectDelay</span> <span class="o">||</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">maxReconnectDelay</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxReconnectDelay</span> <span class="o">||</span> <span class="mi">30000</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">backoffFactor</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">backoffFactor</span> <span class="o">||</span> <span class="mf">1.5</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatInterval</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">heartbeatInterval</span> <span class="o">||</span> <span class="mi">30000</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isReconnecting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shouldReconnect</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">connectionId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startHeartbeat</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">protocols</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setupEventHandlers</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleConnectionError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">setupEventHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">WebSocket connected</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isReconnecting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connectionId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateConnectionId</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      
      <span class="c1">// Send queued messages</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">flushMessageQueue</span><span class="p">();</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="na">raw</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">WebSocket closed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldReconnect</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">wasClean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleReconnection</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">WebSocket error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleConnectionError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">handleMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle different message types</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pong</span><span class="dl">'</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="p">});</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">pong</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handlePong</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">auth_required</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">auth_required</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">auth_success</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">auth_success</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">auth_failed</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">auth_failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handlePong</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">latency</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">latency</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">latency</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="nx">data</span> <span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Queue message for later</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">flushMessageQueue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleReconnection</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isReconnecting</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxReconnectAttempts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">isReconnecting</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span><span class="o">++</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">delay</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">reconnectDelay</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">backoffFactor</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">maxReconnectDelay</span>
    <span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Reconnecting in </span><span class="p">${</span><span class="nx">delay</span><span class="p">}</span><span class="s2">ms (attempt </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">reconnecting</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">attempt</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span><span class="p">,</span> <span class="nx">delay</span> <span class="p">});</span>

    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldReconnect</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleConnectionError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldReconnect</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleReconnection</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">startHeartbeat</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">timeSinceLastActivity</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">timeSinceLastActivity</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatInterval</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ping</span><span class="dl">'</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatInterval</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">authenticate</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">auth</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">credentials</span><span class="p">,</span>
      <span class="na">connectionId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">connectionId</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">subscribe</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subscribe</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">channel</span><span class="p">,</span>
      <span class="nx">params</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">unsubscribe</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">channel</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Event emitter functionality</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">[]);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">off</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">listeners</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
      <span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">listener</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">listener</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error in event listener:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shouldReconnect</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Client closing connection</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">getConnectionState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">readyState</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">?.</span><span class="nx">readyState</span><span class="p">,</span>
      <span class="na">connectionId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">connectionId</span><span class="p">,</span>
      <span class="na">reconnectAttempts</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconnectAttempts</span><span class="p">,</span>
      <span class="na">isReconnecting</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">isReconnecting</span><span class="p">,</span>
      <span class="na">messageQueueLength</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">lastActivity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastActivity</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">generateConnectionId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="security-and-cors">Security and CORS</h2>

<h3 id="advanced-cors-and-security-headers"><strong>Advanced CORS and Security Headers</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
</pre></td><td class="rouge-code"><pre><span class="c1">// CORS and security utilities for frontend applications</span>
<span class="kd">class</span> <span class="nx">NetworkSecurity</span> <span class="p">{</span>
  
  <span class="c1">// CORS preflight request analyzer</span>
  <span class="kd">static</span> <span class="k">async</span> <span class="nx">analyzeCORS</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">method</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">analysis</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">url</span><span class="p">,</span>
      <span class="nx">method</span><span class="p">,</span>
      <span class="nx">headers</span><span class="p">,</span>
      <span class="na">preflightRequired</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">preflightResponse</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="na">actualRequestAllowed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">corsHeaders</span><span class="p">:</span> <span class="p">{},</span>
      <span class="na">securityHeaders</span><span class="p">:</span> <span class="p">{},</span>
      <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">recommendations</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">};</span>

    <span class="c1">// Check if preflight is required</span>
    <span class="nx">analysis</span><span class="p">.</span><span class="nx">preflightRequired</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">requiresPreflight</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">headers</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">preflightRequired</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Send OPTIONS request</span>
        <span class="kd">const</span> <span class="nx">preflightResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">OPTIONS</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">'</span><span class="s1">Origin</span><span class="dl">'</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Access-Control-Request-Method</span><span class="dl">'</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Access-Control-Request-Headers</span><span class="dl">'</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">headers</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">, </span><span class="dl">'</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">});</span>

        <span class="nx">analysis</span><span class="p">.</span><span class="nx">preflightResponse</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">status</span><span class="p">:</span> <span class="nx">preflightResponse</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
          <span class="na">headers</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">fromEntries</span><span class="p">(</span><span class="nx">preflightResponse</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span>
        <span class="p">};</span>

        <span class="c1">// Parse CORS headers</span>
        <span class="nx">analysis</span><span class="p">.</span><span class="nx">corsHeaders</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseCORSHeaders</span><span class="p">(</span><span class="nx">preflightResponse</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
        <span class="nx">analysis</span><span class="p">.</span><span class="nx">actualRequestAllowed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isRequestAllowed</span><span class="p">(</span>
          <span class="nx">method</span><span class="p">,</span> 
          <span class="nx">headers</span><span class="p">,</span> 
          <span class="nx">analysis</span><span class="p">.</span><span class="nx">corsHeaders</span>
        <span class="p">);</span>

      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">analysis</span><span class="p">.</span><span class="nx">warnings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`Preflight request failed: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">analysis</span><span class="p">.</span><span class="nx">actualRequestAllowed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Security analysis</span>
    <span class="nx">analysis</span><span class="p">.</span><span class="nx">securityHeaders</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">analyzeSecurityHeaders</span><span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">preflightResponse</span><span class="p">?.</span><span class="nx">headers</span><span class="p">);</span>
    <span class="nx">analysis</span><span class="p">.</span><span class="nx">recommendations</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateSecurityRecommendations</span><span class="p">(</span><span class="nx">analysis</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">analysis</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">requiresPreflight</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">simpleMethod</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">HEAD</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">());</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">simpleMethod</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">simpleHeaders</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">accept</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">accept-language</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">content-language</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span>
    <span class="p">];</span>

    <span class="kd">const</span> <span class="nx">hasComplexHeaders</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">headers</span><span class="p">).</span><span class="nx">some</span><span class="p">(</span><span class="nx">header</span> <span class="o">=&gt;</span> 
      <span class="o">!</span><span class="nx">simpleHeaders</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">hasComplexHeaders</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">contentType</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">]</span> <span class="o">||</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">simpleContentTypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="dl">'</span><span class="s1">application/x-www-form-urlencoded</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">multipart/form-data</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span>
      <span class="p">];</span>
      
      <span class="kd">const</span> <span class="nx">isSimpleContentType</span> <span class="o">=</span> <span class="nx">simpleContentTypes</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">type</span> <span class="o">=&gt;</span> 
        <span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span>
      <span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isSimpleContentType</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">parseCORSHeaders</span><span class="p">(</span><span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">allowOrigin</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-allow-origin</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">allowMethods</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-allow-methods</span><span class="dl">'</span><span class="p">)?.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">m</span> <span class="o">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">trim</span><span class="p">()),</span>
      <span class="na">allowHeaders</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-allow-headers</span><span class="dl">'</span><span class="p">)?.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">.</span><span class="nx">trim</span><span class="p">()),</span>
      <span class="na">allowCredentials</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-allow-credentials</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">exposeHeaders</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-expose-headers</span><span class="dl">'</span><span class="p">)?.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">.</span><span class="nx">trim</span><span class="p">()),</span>
      <span class="na">maxAge</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">access-control-max-age</span><span class="dl">'</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">isRequestAllowed</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">headers</span><span class="p">,</span> <span class="nx">corsHeaders</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Check method</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowMethods</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowMethods</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">method</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Check headers</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowHeaders</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">requestHeaders</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">headers</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
      <span class="kd">const</span> <span class="nx">allowedHeaders</span> <span class="o">=</span> <span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowHeaders</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">header</span> <span class="k">of</span> <span class="nx">requestHeaders</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">allowedHeaders</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">header</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">analyzeSecurityHeaders</span><span class="p">(</span><span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">headers</span><span class="p">)</span> <span class="k">return</span> <span class="p">{};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="na">contentSecurityPolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-security-policy</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">strictTransportSecurity</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">strict-transport-security</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">xFrameOptions</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">x-frame-options</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">xContentTypeOptions</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">x-content-type-options</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">xXSSProtection</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">x-xss-protection</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">referrerPolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">referrer-policy</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">permissionsPolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">permissions-policy</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">crossOriginEmbedderPolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">cross-origin-embedder-policy</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">crossOriginOpenerPolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">cross-origin-opener-policy</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">crossOriginResourcePolicy</span><span class="p">:</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">cross-origin-resource-policy</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">generateSecurityRecommendations</span><span class="p">(</span><span class="nx">analysis</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">securityHeaders</span><span class="p">,</span> <span class="nx">corsHeaders</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">analysis</span><span class="p">;</span>

    <span class="c1">// CORS recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowOrigin</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowCredentials</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Wildcard origin with credentials is not allowed</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">corsHeaders</span><span class="p">.</span><span class="nx">allowOrigin</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Consider restricting allowed origins instead of using wildcard</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Security headers recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">securityHeaders</span><span class="p">.</span><span class="nx">contentSecurityPolicy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Content Security Policy header is missing</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">securityHeaders</span><span class="p">.</span><span class="nx">strictTransportSecurity</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Strict Transport Security header is missing</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">securityHeaders</span><span class="p">.</span><span class="nx">xFrameOptions</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">X-Frame-Options header is missing</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">securityHeaders</span><span class="p">.</span><span class="nx">xContentTypeOptions</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">security</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">low</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">X-Content-Type-Options header is missing</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">recommendations</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Content Security Policy helper</span>
  <span class="kd">static</span> <span class="nx">generateCSP</span><span class="p">(</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span>
      <span class="nx">defaultSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">scriptSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">styleSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">'unsafe-inline'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">imgSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">'</span><span class="s1">data:</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https:</span><span class="dl">'</span><span class="p">],</span>
      <span class="nx">fontSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">connectSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">objectSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'none'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">mediaSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">frameSrc</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'none'</span><span class="dl">"</span><span class="p">],</span>
      <span class="nx">reportUri</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">reportTo</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nx">upgradeInsecureRequests</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">directives</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`default-src </span><span class="p">${</span><span class="nx">defaultSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`script-src </span><span class="p">${</span><span class="nx">scriptSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`style-src </span><span class="p">${</span><span class="nx">styleSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`img-src </span><span class="p">${</span><span class="nx">imgSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`font-src </span><span class="p">${</span><span class="nx">fontSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`connect-src </span><span class="p">${</span><span class="nx">connectSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`object-src </span><span class="p">${</span><span class="nx">objectSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`media-src </span><span class="p">${</span><span class="nx">mediaSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`frame-src </span><span class="p">${</span><span class="nx">frameSrc</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">upgradeInsecureRequests</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">upgrade-insecure-requests</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">reportUri</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`report-uri </span><span class="p">${</span><span class="nx">reportUri</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">reportTo</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">directives</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`report-to </span><span class="p">${</span><span class="nx">reportTo</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">directives</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">; </span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Validate and sanitize URLs</span>
  <span class="kd">static</span> <span class="nx">validateURL</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">allowedProtocols</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">http:</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https:</span><span class="dl">'</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">parsedURL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">allowedProtocols</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">parsedURL</span><span class="p">.</span><span class="nx">protocol</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Protocol </span><span class="p">${</span><span class="nx">parsedURL</span><span class="p">.</span><span class="nx">protocol</span><span class="p">}</span><span class="s2"> not allowed`</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Check for dangerous patterns</span>
      <span class="kd">const</span> <span class="nx">dangerousPatterns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sr">/javascript:/i</span><span class="p">,</span>
        <span class="sr">/data:/i</span><span class="p">,</span>
        <span class="sr">/vbscript:/i</span><span class="p">,</span>
        <span class="sr">/file:/i</span>
      <span class="p">];</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">pattern</span> <span class="k">of</span> <span class="nx">dangerousPatterns</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">URL contains dangerous pattern</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="na">isValid</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">parsedURL</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
        <span class="na">protocol</span><span class="p">:</span> <span class="nx">parsedURL</span><span class="p">.</span><span class="nx">protocol</span><span class="p">,</span>
        <span class="na">hostname</span><span class="p">:</span> <span class="nx">parsedURL</span><span class="p">.</span><span class="nx">hostname</span><span class="p">,</span>
        <span class="na">pathname</span><span class="p">:</span> <span class="nx">parsedURL</span><span class="p">.</span><span class="nx">pathname</span>
      <span class="p">};</span>

    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">isValid</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Request signing for API authentication</span>
  <span class="kd">static</span> <span class="nx">signRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">algorithm</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">SHA-256</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">headers</span><span class="p">,</span> <span class="nx">body</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">request</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">signaturePayload</span> <span class="o">=</span> <span class="p">[</span>
      <span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">(),</span>
      <span class="nx">url</span><span class="p">,</span>
      <span class="nx">timestamp</span><span class="p">,</span>
      <span class="nx">nonce</span><span class="p">,</span>
      <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">headers</span> <span class="o">||</span> <span class="p">{}),</span>
      <span class="nx">body</span> <span class="o">||</span> <span class="dl">''</span>
    <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">timestamp</span><span class="p">,</span>
      <span class="nx">nonce</span><span class="p">,</span>
      <span class="na">signature</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">hmacSign</span><span class="p">(</span><span class="nx">signaturePayload</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">algorithm</span><span class="p">),</span>
      <span class="na">signatureMethod</span><span class="p">:</span> <span class="nx">algorithm</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="k">async</span> <span class="nx">hmacSign</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">algorithm</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextEncoder</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">importKey</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">raw</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">secret</span><span class="p">),</span>
      <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">HMAC</span><span class="dl">'</span><span class="p">,</span> <span class="na">hash</span><span class="p">:</span> <span class="nx">algorithm</span> <span class="p">},</span>
      <span class="kc">false</span><span class="p">,</span>
      <span class="p">[</span><span class="dl">'</span><span class="s1">sign</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">);</span>

    <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">HMAC</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">key</span><span class="p">,</span>
      <span class="nx">encoder</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">signature</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span> <span class="o">=&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Rate limiting client-side tracking</span>
  <span class="kd">static</span> <span class="nx">createRateLimiter</span><span class="p">(</span><span class="nx">windowMs</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span> <span class="nx">maxRequests</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">requests</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">isAllowed</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
        
        <span class="c1">// Remove old requests outside the window</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">windowMs</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">requests</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">maxRequests</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">allowed</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="na">retryAfter</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">windowMs</span> <span class="o">-</span> <span class="nx">now</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
          <span class="p">};</span>
        <span class="p">}</span>
        
        <span class="nx">requests</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">now</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">allowed</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">remaining</span><span class="p">:</span> <span class="nx">maxRequests</span> <span class="o">-</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span>
        <span class="p">};</span>
      <span class="p">},</span>
      
      <span class="nx">reset</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">},</span>
      
      <span class="nx">getStatus</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">validRequests</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">time</span> <span class="o">=&gt;</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">time</span> <span class="o">&lt;=</span> <span class="nx">windowMs</span><span class="p">);</span>
        
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">requestCount</span><span class="p">:</span> <span class="nx">validRequests</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
          <span class="nx">maxRequests</span><span class="p">,</span>
          <span class="nx">windowMs</span><span class="p">,</span>
          <span class="na">resetTime</span><span class="p">:</span> <span class="nx">validRequests</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">validRequests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">windowMs</span> <span class="p">:</span> <span class="nx">now</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="network-performance-optimization">Network Performance Optimization</h2>

<h3 id="connection-optimization-strategies"><strong>Connection Optimization Strategies</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
</pre></td><td class="rouge-code"><pre><span class="c1">// Network performance optimization utilities</span>
<span class="kd">class</span> <span class="nx">NetworkOptimization</span> <span class="p">{</span>
  
  <span class="c1">// Connection monitoring and optimization</span>
  <span class="kd">static</span> <span class="nx">monitorConnection</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">connection</span> <span class="o">||</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">mozConnection</span> <span class="o">||</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">webkitConnection</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">supported</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Network Information API not supported</span><span class="dl">'</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">monitor</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">supported</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">current</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getConnectionInfo</span><span class="p">(</span><span class="nx">connection</span><span class="p">),</span>
      <span class="na">history</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">listeners</span><span class="p">:</span> <span class="p">[],</span>
      
      <span class="nx">onChange</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
        <span class="nx">connection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">newInfo</span> <span class="o">=</span> <span class="nx">NetworkOptimization</span><span class="p">.</span><span class="nx">getConnectionInfo</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">newInfo</span><span class="p">,</span>
            <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
          <span class="p">});</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">newInfo</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">},</span>
      
      <span class="nx">getOptimizationStrategy</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">NetworkOptimization</span><span class="p">.</span><span class="nx">getOptimizationStrategy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="nx">shouldOptimizeForLowBandwidth</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">effectiveType</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">slow-2g</span><span class="dl">'</span> <span class="o">||</span> 
               <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">effectiveType</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">2g</span><span class="dl">'</span> <span class="o">||</span>
               <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">downlink</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">downlink</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="nx">shouldPreloadResources</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">effectiveType</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">4g</span><span class="dl">'</span> <span class="o">||</span>
               <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">downlink</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">downlink</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">monitor</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">getConnectionInfo</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">effectiveType</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">,</span>
      <span class="na">downlink</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">downlink</span><span class="p">,</span>
      <span class="na">downlinkMax</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">downlinkMax</span><span class="p">,</span>
      <span class="na">rtt</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">rtt</span><span class="p">,</span>
      <span class="na">saveData</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">saveData</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">type</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">getOptimizationStrategy</span><span class="p">(</span><span class="nx">connectionInfo</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">effectiveType</span><span class="p">,</span> <span class="nx">downlink</span><span class="p">,</span> <span class="nx">saveData</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connectionInfo</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">saveData</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">data-saver</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendations</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">Enable aggressive compression</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Reduce image quality</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Minimize non-essential requests</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Use text instead of images where possible</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">effectiveType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">slow-2g</span><span class="dl">'</span><span class="p">:</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">2g</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">low-bandwidth</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">recommendations</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">'</span><span class="s1">Use critical CSS inline</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Defer non-critical JavaScript</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Compress all resources aggressively</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Use WebP images with low quality</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Implement aggressive caching</span><span class="dl">'</span>
          <span class="p">]</span>
        <span class="p">};</span>
      
      <span class="k">case</span> <span class="dl">'</span><span class="s1">3g</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">moderate-bandwidth</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">recommendations</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">'</span><span class="s1">Preload critical resources</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Use responsive images</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Enable resource hints</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Implement smart bundling</span><span class="dl">'</span>
          <span class="p">]</span>
        <span class="p">};</span>
      
      <span class="k">case</span> <span class="dl">'</span><span class="s1">4g</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high-bandwidth</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">recommendations</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">'</span><span class="s1">Preload next page resources</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Use high-quality images</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Enable speculative loading</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Implement aggressive prefetching</span><span class="dl">'</span>
          <span class="p">]</span>
        <span class="p">};</span>
      
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">strategy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">adaptive</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">recommendations</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">'</span><span class="s1">Monitor connection changes</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Adapt strategy dynamically</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">'</span><span class="s1">Use progressive enhancement</span><span class="dl">'</span>
          <span class="p">]</span>
        <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Resource hints optimization</span>
  <span class="kd">static</span> <span class="nx">optimizeResourceHints</span><span class="p">(</span><span class="nx">resources</span><span class="p">,</span> <span class="nx">connectionInfo</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">optimized</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">preload</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">prefetch</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">preconnect</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">dnsPrefetch</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">strategy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOptimizationStrategy</span><span class="p">(</span><span class="nx">connectionInfo</span><span class="p">);</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">resource</span> <span class="k">of</span> <span class="nx">resources</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">critical</span> <span class="o">&amp;&amp;</span> <span class="nx">strategy</span><span class="p">.</span><span class="nx">strategy</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">low-bandwidth</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">optimized</span><span class="p">.</span><span class="nx">preload</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="na">href</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
          <span class="na">as</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
          <span class="na">crossorigin</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">crossorigin</span>
        <span class="p">});</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">nextPage</span> <span class="o">&amp;&amp;</span> <span class="nx">strategy</span><span class="p">.</span><span class="nx">strategy</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">high-bandwidth</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">optimized</span><span class="p">.</span><span class="nx">prefetch</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="na">href</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">url</span>
        <span class="p">});</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">externalDomain</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">strategy</span><span class="p">.</span><span class="nx">strategy</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">high-bandwidth</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">optimized</span><span class="p">.</span><span class="nx">preconnect</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="na">href</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">domain</span><span class="p">,</span>
            <span class="na">crossorigin</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">crossorigin</span>
          <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">optimized</span><span class="p">.</span><span class="nx">dnsPrefetch</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="na">href</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">domain</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">optimized</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// HTTP/2 Push optimization</span>
  <span class="kd">static</span> <span class="nx">optimizeHTTP2Push</span><span class="p">(</span><span class="nx">criticalResources</span><span class="p">,</span> <span class="nx">requestHistory</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">pushCandidates</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="nx">requestMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    
    <span class="c1">// Analyze request patterns</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">request</span> <span class="k">of</span> <span class="nx">requestHistory</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">request</span><span class="p">.</span><span class="nx">referer</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">requestMap</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">requestMap</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[]);</span>
      <span class="p">}</span>
      <span class="nx">requestMap</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">resource</span> <span class="k">of</span> <span class="nx">criticalResources</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">score</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculatePushScore</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">requestMap</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">score</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// High confidence threshold</span>
        <span class="nx">pushCandidates</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="p">...</span><span class="nx">resource</span><span class="p">,</span>
          <span class="na">pushScore</span><span class="p">:</span> <span class="nx">score</span><span class="p">,</span>
          <span class="na">priority</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPushPriority</span><span class="p">(</span><span class="nx">resource</span><span class="p">)</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Sort by priority and push score</span>
    <span class="nx">pushCandidates</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">priority</span> <span class="o">!==</span> <span class="nx">b</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">priority</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">priority</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">pushScore</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pushScore</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">pushCandidates</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// Limit to 6 resources</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">calculatePushScore</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">requestMap</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">resource</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">resource</span><span class="p">.</span><span class="nx">referer</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">requests</span> <span class="o">=</span> <span class="nx">requestMap</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="c1">// Calculate request frequency</span>
    <span class="kd">const</span> <span class="nx">timeSpan</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">requests</span><span class="p">)</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(...</span><span class="nx">requests</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">frequency</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="p">(</span><span class="nx">timeSpan</span> <span class="o">||</span> <span class="mi">1</span><span class="p">);</span>
    
    <span class="c1">// Calculate consistency (lower variance in timing = higher score)</span>
    <span class="kd">const</span> <span class="nx">intervals</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">intervals</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">requests</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="nx">requests</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">avgInterval</span> <span class="o">=</span> <span class="nx">intervals</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">intervals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">variance</span> <span class="o">=</span> <span class="nx">intervals</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">interval</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">interval</span> <span class="o">-</span> <span class="nx">avgInterval</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">intervals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">consistency</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">variance</span><span class="p">)</span> <span class="o">/</span> <span class="nx">avgInterval</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">frequency</span> <span class="o">*</span> <span class="nx">consistency</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">getPushPriority</span><span class="p">(</span><span class="nx">resource</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">priorityMap</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">font</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">document</span><span class="dl">'</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">};</span>
    
    <span class="k">return</span> <span class="nx">priorityMap</span><span class="p">[</span><span class="nx">resource</span><span class="p">.</span><span class="nx">type</span><span class="p">]</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Service Worker caching strategy optimizer</span>
  <span class="kd">static</span> <span class="nx">optimizeCachingStrategy</span><span class="p">(</span><span class="nx">resources</span><span class="p">,</span> <span class="nx">usage</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">strategies</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cacheFirst</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">networkFirst</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">staleWhileRevalidate</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">networkOnly</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">cacheOnly</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">resource</span> <span class="k">of</span> <span class="nx">resources</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">strategy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectCachingStrategy</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">usage</span><span class="p">[</span><span class="nx">resource</span><span class="p">.</span><span class="nx">url</span><span class="p">]);</span>
      <span class="nx">strategies</span><span class="p">[</span><span class="nx">strategy</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">resource</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">strategies</span><span class="p">,</span>
      <span class="na">swConfig</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateSWConfig</span><span class="p">(</span><span class="nx">strategies</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">selectCachingStrategy</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">usageStats</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">updateFrequency</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">accessFrequency</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">usageStats</span><span class="p">;</span>
    
    <span class="c1">// Static assets that rarely change</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">font</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">cacheFirst</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// API responses that change frequently</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">api</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">updateFrequency</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">networkFirst</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Content that's acceptable to be stale</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">api</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">updateFrequency</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">staleWhileRevalidate</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Large files accessed infrequently</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="mi">1000000</span> <span class="o">&amp;&amp;</span> <span class="nx">accessFrequency</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">networkOnly</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Default to network first for dynamic content</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">networkFirst</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">generateSWConfig</span><span class="p">(</span><span class="nx">strategies</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">runtimeCaching</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">strategy</span><span class="p">,</span> <span class="nx">resources</span><span class="p">]</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">strategies</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resources</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">urlPatterns</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">||</span> <span class="nx">r</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
      
      <span class="nx">config</span><span class="p">.</span><span class="nx">runtimeCaching</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">urlPattern</span><span class="p">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">urlPatterns</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">|</span><span class="dl">'</span><span class="p">)),</span>
        <span class="na">handler</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">strategyToHandler</span><span class="p">(</span><span class="nx">strategy</span><span class="p">),</span>
        <span class="na">options</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStrategyOptions</span><span class="p">(</span><span class="nx">strategy</span><span class="p">,</span> <span class="nx">resources</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">config</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">strategyToHandler</span><span class="p">(</span><span class="nx">strategy</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">handlerMap</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cacheFirst</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CacheFirst</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">networkFirst</span><span class="p">:</span> <span class="dl">'</span><span class="s1">NetworkFirst</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">staleWhileRevalidate</span><span class="p">:</span> <span class="dl">'</span><span class="s1">StaleWhileRevalidate</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">networkOnly</span><span class="p">:</span> <span class="dl">'</span><span class="s1">NetworkOnly</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">cacheOnly</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CacheOnly</span><span class="dl">'</span>
    <span class="p">};</span>
    
    <span class="k">return</span> <span class="nx">handlerMap</span><span class="p">[</span><span class="nx">strategy</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">getStrategyOptions</span><span class="p">(</span><span class="nx">strategy</span><span class="p">,</span> <span class="nx">resources</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cacheName</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">strategy</span><span class="p">}</span><span class="s2">-cache`</span><span class="p">,</span>
      <span class="na">cacheKeyWillBeUsed</span><span class="p">:</span> <span class="p">({</span> <span class="nx">request</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Custom cache key logic</span>
        <span class="k">return</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">strategy</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">networkFirst</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">strategy</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">staleWhileRevalidate</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">networkTimeoutSeconds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">strategy</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">cacheFirst</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">cacheableResponse</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">statuses</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// Set expiration based on resource type</span>
    <span class="kd">const</span> <span class="nx">maxAge</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMaxAge</span><span class="p">(</span><span class="nx">resources</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">maxAge</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">expiration</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">maxAgeSeconds</span><span class="p">:</span> <span class="nx">maxAge</span><span class="p">,</span>
        <span class="na">maxEntries</span><span class="p">:</span> <span class="mi">100</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">getMaxAge</span><span class="p">(</span><span class="nx">resources</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">font</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// 1 year</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// 30 days</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// 7 days</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">api</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// 1 hour</span>
    
    <span class="k">return</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// 1 day default</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This comprehensive networking and HTTP fundamentals guide provides the essential knowledge for building secure, performant, and reliable frontend applications that communicate effectively with backend services and handle various network conditions.</p>

        </div>
    </article>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Study Resources</h3>
                    <p>Comprehensive collection of frontend interview questions, coding challenges, and system design problems.</p>
                </div>
                <div class="footer-section">
                    <h3>Progress Tracking</h3>
                    <p>Monitor your learning journey with detailed progress indicators and completion status.</p>
                </div>
                <div class="footer-section">
                    <h3>Big Tech Ready</h3>
                    <p>Curated content specifically designed for interviews at Google, Meta, Amazon, Apple, and Netflix.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Frontend Interview Hub. Built for aspiring frontend engineers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/assets/js/app.js"></script>
</body>
</html>