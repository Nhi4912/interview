<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Internals &amp; Web Platform Fundamentals | Frontend Interview Preparation Guide</title>
    <meta name="description" content="Comprehensive frontend interview materials for Big Tech companies">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="container">
            <div class="logo">Frontend Interview Hub</div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span aria-hidden="true">☰</span>
            </button>
            <ul class="nav-links" role="navigation" aria-label="Main navigation">
                <li><a href="/">Home</a></li>
                <li><a href="#progress">Progress</a></li>
                <li><a href="#knowledge">Knowledge</a></li>
                <li><a href="https://github.com/nee/interview" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="content-container">
    
        <nav class="breadcrumb">
            <ol>
                <li><a href="/">Home</a></li>
                
                
                
                    
                
                    
                        
                        
                            <li><a href="/frontend/">Frontend</a></li>
                        
                    
                
                    
                        
                        
                            <li><a href="/frontend/fundamentals/">Fundamentals</a></li>
                        
                    
                
                    
                        
                        
                            <li class="active">Browser internals &amp; web platform fundamentals</li>
                        
                    
                
            </ol>
        </nav>
    
    
    <article class="content">
        
            <header class="content-header">
                <h1 class="content-title">Browser Internals &amp; Web Platform Fundamentals</h1>
                
                
            </header>
        
        
        <div class="content-body">
            <h1 id="browser-internals--web-platform-fundamentals">Browser Internals &amp; Web Platform Fundamentals</h1>

<h2 id="overview">Overview</h2>
<p>Understanding how browsers work internally is crucial for frontend optimization and debugging. This guide covers browser architecture, rendering pipeline, and web platform APIs.</p>

<hr />

<h2 id="browser-architecture-deep-dive">Browser Architecture Deep Dive</h2>

<h3 id="multi-process-architecture"><strong>Multi-Process Architecture</strong></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>┌─────────────────────────────────────────────────────────────────┐
│                      BROWSER PROCESS ARCHITECTURE               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌──────────────────┐                   │
│  │  Browser Process │    │  Renderer Process │                  │
│  │                 │    │                  │                   │
│  │  • UI Thread    │◄──►│  • Main Thread   │                   │
│  │  • IO Thread    │    │  • Compositor    │                   │
│  │  • Storage      │    │  • Raster Thread │                   │
│  │  • Network      │    │  • Worker Threads│                   │
│  └─────────────────┘    └──────────────────┘                   │
│           ▲                        ▲                           │
│           │                        │                           │
│  ┌─────────────────┐    ┌──────────────────┐                   │
│  │   GPU Process   │    │  Plugin Process  │                   │
│  │                 │    │                  │                   │
│  │  • Graphics     │    │  • Sandboxed     │                   │
│  │  • Hardware     │    │  • Isolated      │                   │
│  │  • Acceleration │    │  • Legacy        │                   │
│  └─────────────────┘    └──────────────────┘                   │
└─────────────────────────────────────────────────────────────────┘
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
</pre></td><td class="rouge-code"><pre><span class="c1">// Understanding browser processes and their communication</span>
<span class="kd">class</span> <span class="nx">BrowserArchitectureDemo</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">processInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProcessInformation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">memoryUsage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getMemoryUsage</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Detect current browser architecture</span>
  <span class="nx">getProcessInformation</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">userAgent</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">,</span>
      <span class="na">platform</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p">,</span>
      <span class="na">hardwareConcurrency</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">hardwareConcurrency</span><span class="p">,</span>
      <span class="na">deviceMemory</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">deviceMemory</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">connection</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">connection</span> <span class="p">?</span> <span class="p">{</span>
        <span class="na">effectiveType</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">,</span>
        <span class="na">downlink</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">downlink</span><span class="p">,</span>
        <span class="na">rtt</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">rtt</span>
      <span class="p">}</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span>
    <span class="p">};</span>

    <span class="c1">// Detect if running in isolated context (like iframe)</span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">isIsolated</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">self</span> <span class="o">!==</span> <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
    
    <span class="c1">// Check for service worker support (indicates multi-process architecture)</span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">supportsServiceWorker</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">;</span>
    
    <span class="c1">// Check for shared worker support</span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">supportsSharedWorker</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">SharedWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">info</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Monitor memory usage across processes</span>
  <span class="nx">getMemoryUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">memory</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">performance</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">usedJSHeapSize</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span><span class="p">,</span>
        <span class="na">totalJSHeapSize</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">totalJSHeapSize</span><span class="p">,</span>
        <span class="na">jsHeapSizeLimit</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">jsHeapSizeLimit</span><span class="p">,</span>
        <span class="na">percentage</span><span class="p">:</span> <span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span> <span class="o">/</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">jsHeapSizeLimit</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Demonstrate cross-process communication</span>
  <span class="nx">demonstrateCrossProcessCommunication</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Main thread to worker communication</span>
    <span class="kd">const</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="dl">'</span><span class="s1">/js/worker.js</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">HEAVY_COMPUTATION</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">1000000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="nx">worker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Received from worker process:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="c1">// Service worker communication</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">registration</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">registration</span><span class="p">.</span><span class="nx">active</span><span class="p">?.</span><span class="nx">postMessage</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CACHE_UPDATE</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">urls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">/api/data</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/assets/images/hero.jpg</span><span class="dl">'</span><span class="p">]</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Shared worker communication</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">SharedWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">sharedWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SharedWorker</span><span class="p">(</span><span class="dl">'</span><span class="s1">/js/shared-worker.js</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="nx">sharedWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">INIT</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">tabId</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
      <span class="p">});</span>

      <span class="nx">sharedWorker</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Shared worker message:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Monitor process isolation</span>
  <span class="nx">testProcessIsolation</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">tests</span> <span class="o">=</span> <span class="p">{</span>
      <span class="c1">// Test if different origins are isolated</span>
      <span class="na">crossOriginIsolation</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">testCrossOriginIsolation</span><span class="p">(),</span>
      
      <span class="c1">// Test site isolation</span>
      <span class="na">siteIsolation</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">testSiteIsolation</span><span class="p">(),</span>
      
      <span class="c1">// Test sandbox attributes</span>
      <span class="na">sandboxSupport</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">testSandboxSupport</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">tests</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">testCrossOriginIsolation</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Try to access cross-origin iframe</span>
      <span class="kd">const</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">iframe</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://example.com</span><span class="dl">'</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
      
      <span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="c1">// This should fail due to same-origin policy</span>
          <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cross-origin access succeeded (unexpected)</span><span class="dl">'</span><span class="p">);</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cross-origin access blocked (expected)</span><span class="dl">'</span><span class="p">);</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// Properly isolated</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">testSiteIsolation</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Check if Spectre mitigations are active</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="c1">// Create array to test memory access patterns</span>
    <span class="kd">const</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">);</span> <span class="c1">// 1MB</span>
    <span class="kd">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
    
    <span class="c1">// Fill with pattern</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">view</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">view</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="c1">// If site isolation is active, certain memory access patterns</span>
    <span class="c1">// may be slower due to security mitigations</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">duration</span><span class="p">:</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">,</span>
      <span class="na">isolated</span><span class="p">:</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="c1">// Simplified heuristic</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">testSandboxSupport</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">allow-scripts allow-same-origin</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
    
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">sandboxFeatures</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">allowScripts</span><span class="p">:</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">allow-scripts</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">allowSameOrigin</span><span class="p">:</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">allow-same-origin</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">allowForms</span><span class="p">:</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">allow-forms</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">allowPopups</span><span class="p">:</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">allow-popups</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">};</span>
    
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">sandboxFeatures</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="rendering-pipeline-deep-dive">Rendering Pipeline Deep Dive</h2>

<h3 id="critical-rendering-path"><strong>Critical Rendering Path</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
</pre></td><td class="rouge-code"><pre><span class="c1">// Understanding and optimizing the critical rendering path</span>
<span class="kd">class</span> <span class="nx">CriticalRenderingPath</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handlePerformanceEntries</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setupObservers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">setupObservers</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Observe navigation timing</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">navigation</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
    
    <span class="c1">// Observe paint timing</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
    
    <span class="c1">// Observe layout shifts</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout-shift</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
    
    <span class="c1">// Observe largest contentful paint</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">largest-contentful-paint</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">handlePerformanceEntries</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">();</span>
    
    <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entry</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">entryType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">navigation</span><span class="dl">'</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">analyzeNavigationTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">analyzePaintTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">layout-shift</span><span class="dl">'</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">analyzeLayoutShift</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="dl">'</span><span class="s1">largest-contentful-paint</span><span class="dl">'</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">analyzeLCP</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">analyzeNavigationTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">timing</span> <span class="o">=</span> <span class="p">{</span>
      <span class="c1">// DNS Resolution</span>
      <span class="na">dnsLookup</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">domainLookupEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">domainLookupStart</span><span class="p">,</span>
      
      <span class="c1">// TCP Connection</span>
      <span class="na">tcpConnection</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">connectStart</span><span class="p">,</span>
      
      <span class="c1">// SSL Negotiation</span>
      <span class="na">sslNegotiation</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">secureConnectionStart</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> 
        <span class="nx">entry</span><span class="p">.</span><span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">secureConnectionStart</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      
      <span class="c1">// Request/Response</span>
      <span class="na">requestTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">responseStart</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">requestStart</span><span class="p">,</span>
      <span class="na">responseTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">responseEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">responseStart</span><span class="p">,</span>
      
      <span class="c1">// DOM Processing</span>
      <span class="na">domProcessing</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">domContentLoadedEventEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">responseEnd</span><span class="p">,</span>
      
      <span class="c1">// Resource Loading</span>
      <span class="na">resourceLoading</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">loadEventStart</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">domContentLoadedEventEnd</span><span class="p">,</span>
      
      <span class="c1">// Total Time</span>
      <span class="na">totalTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">loadEventEnd</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">navigationStart</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">navigation</span><span class="dl">'</span><span class="p">,</span> <span class="nx">timing</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">identifyBottlenecks</span><span class="p">(</span><span class="nx">timing</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">analyzePaintTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">paintMetrics</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">paintMetrics</span><span class="p">[</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="nx">paintMetrics</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">first-contentful-paint</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">analyzeFCP</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">analyzeFCP</span><span class="p">(</span><span class="nx">fcpTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">analysis</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">time</span><span class="p">:</span> <span class="nx">fcpTime</span><span class="p">,</span>
      <span class="na">rating</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFCPRating</span><span class="p">(</span><span class="nx">fcpTime</span><span class="p">),</span>
      <span class="na">recommendations</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFCPRecommendations</span><span class="p">(</span><span class="nx">fcpTime</span><span class="p">)</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">fcp-analysis</span><span class="dl">'</span><span class="p">,</span> <span class="nx">analysis</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getFCPRating</span><span class="p">(</span><span class="nx">fcpTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fcpTime</span> <span class="o">&lt;=</span> <span class="mi">1800</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">good</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fcpTime</span> <span class="o">&lt;=</span> <span class="mi">3000</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">needs-improvement</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">poor</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getFCPRecommendations</span><span class="p">(</span><span class="nx">fcpTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">fcpTime</span> <span class="o">&gt;</span> <span class="mi">1800</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Optimize critical resources</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Reduce server response times</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Eliminate render-blocking resources</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">fcpTime</span> <span class="o">&gt;</span> <span class="mi">3000</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Consider server-side rendering</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Implement resource hints (preload, prefetch)</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Optimize images and fonts</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">recommendations</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">analyzeLayoutShift</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">layoutShifts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">layout-shifts</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
    
    <span class="nx">layoutShifts</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">value</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">sources</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">sources</span><span class="p">?.</span><span class="nx">map</span><span class="p">(</span><span class="nx">source</span> <span class="o">=&gt;</span> <span class="p">({</span>
        <span class="na">node</span><span class="p">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">node</span><span class="p">?.</span><span class="nx">tagName</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">previousRect</span><span class="p">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">previousRect</span><span class="p">,</span>
        <span class="na">currentRect</span><span class="p">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">currentRect</span>
      <span class="p">}))</span> <span class="o">||</span> <span class="p">[],</span>
      <span class="na">hadRecentInput</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">hadRecentInput</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">layout-shifts</span><span class="dl">'</span><span class="p">,</span> <span class="nx">layoutShifts</span><span class="p">);</span>
    
    <span class="c1">// Calculate Cumulative Layout Shift</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">calculateCLS</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">calculateCLS</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">layoutShifts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">layout-shifts</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
    
    <span class="c1">// Group shifts into sessions</span>
    <span class="kd">const</span> <span class="nx">sessions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">groupShiftsIntoSessions</span><span class="p">(</span><span class="nx">layoutShifts</span><span class="p">);</span>
    
    <span class="c1">// Find the session with the maximum CLS</span>
    <span class="kd">const</span> <span class="nx">maxSessionCLS</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">session</span> <span class="o">=&gt;</span> 
      <span class="nx">session</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">shift</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">cls</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">value</span><span class="p">:</span> <span class="nx">maxSessionCLS</span><span class="p">,</span>
      <span class="na">rating</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCLSRating</span><span class="p">(</span><span class="nx">maxSessionCLS</span><span class="p">),</span>
      <span class="na">sessions</span><span class="p">:</span> <span class="nx">sessions</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">totalShifts</span><span class="p">:</span> <span class="nx">layoutShifts</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">groupShiftsIntoSessions</span><span class="p">(</span><span class="nx">shifts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sessions</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">let</span> <span class="nx">currentSession</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="nx">shifts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">shift</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">shift</span><span class="p">.</span><span class="nx">hadRecentInput</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// Ignore shifts after user input</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentSession</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentSession</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">shift</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">timeDiff</span> <span class="o">=</span> <span class="nx">shift</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">currentSession</span><span class="p">[</span><span class="nx">currentSession</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">timestamp</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">timeDiff</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="o">&amp;&amp;</span> <span class="nx">currentSession</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Same session: within 1 second and max 5 shifts</span>
          <span class="nx">currentSession</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">shift</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// New session</span>
          <span class="nx">sessions</span><span class="p">.</span><span class="nx">push</span><span class="p">([...</span><span class="nx">currentSession</span><span class="p">]);</span>
          <span class="nx">currentSession</span> <span class="o">=</span> <span class="p">[</span><span class="nx">shift</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">currentSession</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">sessions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentSession</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">sessions</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getCLSRating</span><span class="p">(</span><span class="nx">clsValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">clsValue</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">good</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">clsValue</span> <span class="o">&lt;=</span> <span class="mf">0.25</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">needs-improvement</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">poor</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">analyzeLCP</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">lcpAnalysis</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">time</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span>
      <span class="na">size</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span>
      <span class="na">element</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">tagName</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">element</span><span class="p">?.</span><span class="nx">tagName</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">id</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">element</span><span class="p">?.</span><span class="nx">id</span> <span class="o">||</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">className</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">element</span><span class="p">?.</span><span class="nx">className</span> <span class="o">||</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="dl">''</span>
      <span class="p">},</span>
      <span class="na">rating</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLCPRating</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">),</span>
      <span class="na">loadTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">loadTime</span><span class="p">,</span>
      <span class="na">renderTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">renderTime</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">lcp</span><span class="dl">'</span><span class="p">,</span> <span class="nx">lcpAnalysis</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getLCPRating</span><span class="p">(</span><span class="nx">lcpTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lcpTime</span> <span class="o">&lt;=</span> <span class="mi">2500</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">good</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lcpTime</span> <span class="o">&lt;=</span> <span class="mi">4000</span><span class="p">)</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">needs-improvement</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">poor</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">identifyBottlenecks</span><span class="p">(</span><span class="nx">timing</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">bottlenecks</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">timing</span><span class="p">.</span><span class="nx">dnsLookup</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bottlenecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dns</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DNS lookup is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Use DNS prefetching or consider CDN</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">timing</span><span class="p">.</span><span class="nx">tcpConnection</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bottlenecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">TCP connection is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Optimize server location or use connection prewarming</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">timing</span><span class="p">.</span><span class="nx">sslNegotiation</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bottlenecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ssl</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">medium</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SSL negotiation is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Optimize SSL configuration or use session resumption</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">timing</span><span class="p">.</span><span class="nx">requestTime</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bottlenecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">server</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Server response time is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Optimize server-side processing and database queries</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">timing</span><span class="p">.</span><span class="nx">domProcessing</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bottlenecks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dom</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">severity</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DOM processing is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">recommendation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Reduce DOM complexity and optimize JavaScript execution</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">bottlenecks</span><span class="dl">'</span><span class="p">,</span> <span class="nx">bottlenecks</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Generate performance report</span>
  <span class="nx">generateReport</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
      <span class="na">url</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
      <span class="na">userAgent</span><span class="p">:</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">,</span>
      <span class="na">metrics</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">fromEntries</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">),</span>
      <span class="na">recommendations</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateRecommendations</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">report</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">generateRecommendations</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="nx">navigation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">navigation</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">paint</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">cls</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">cls</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">lcp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">lcp</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// Navigation recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">navigation</span><span class="p">?.</span><span class="nx">totalTime</span> <span class="o">&gt;</span> <span class="mi">3000</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">category</span><span class="p">:</span> <span class="dl">'</span><span class="s1">loading</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">priority</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Page load time is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">Implement code splitting</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Optimize images and assets</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Use a Content Delivery Network</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Enable browser caching</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Paint recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">paint</span><span class="p">?.[</span><span class="dl">'</span><span class="s1">first-contentful-paint</span><span class="dl">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">category</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rendering</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">priority</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">First Contentful Paint is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">Eliminate render-blocking resources</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Optimize critical CSS delivery</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Reduce server response times</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Use resource hints (preload, prefetch)</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// CLS recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cls</span><span class="p">?.</span><span class="nx">rating</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">poor</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">category</span><span class="p">:</span> <span class="dl">'</span><span class="s1">stability</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">priority</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Cumulative Layout Shift is poor</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">Set explicit dimensions for images and videos</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Reserve space for ad slots</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Avoid inserting content above existing content</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Use CSS transforms for animations</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// LCP recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lcp</span><span class="p">?.</span><span class="nx">rating</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">poor</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">category</span><span class="p">:</span> <span class="dl">'</span><span class="s1">loading</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">priority</span><span class="p">:</span> <span class="dl">'</span><span class="s1">high</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Largest Contentful Paint is slow</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">actions</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">Optimize the LCP element</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Preload important resources</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Reduce server response times</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">Remove unused JavaScript</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">recommendations</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="javascript-engine-internals">JavaScript Engine Internals</h2>

<h3 id="v8-engine-deep-dive"><strong>V8 Engine Deep Dive</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
</pre></td><td class="rouge-code"><pre><span class="c1">// Understanding V8 optimization patterns</span>
<span class="kd">class</span> <span class="nx">V8OptimizationDemo</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">optimizationLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">detectOptimizationLevel</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hiddenClasses</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inlineCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Detect V8 optimization level</span>
  <span class="nx">detectOptimizationLevel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// V8 specific function to check optimization status</span>
    <span class="c1">// Note: These functions are only available in debug builds or with specific flags</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="o">%</span><span class="nx">GetOptimizationStatus</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">debug-build</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Fallback to indirect detection methods</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">indirectOptimizationDetection</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">indirectOptimizationDetection</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="c1">// Run a function multiple times to trigger optimization</span>
    <span class="kd">function</span> <span class="nx">testFunction</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Cold run</span>
    <span class="kd">const</span> <span class="nx">coldResults</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      <span class="nx">testFunction</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="nx">coldResults</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// Warm run (should be optimized)</span>
    <span class="kd">const</span> <span class="nx">warmResults</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      <span class="nx">testFunction</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="nx">warmResults</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">coldAvg</span> <span class="o">=</span> <span class="nx">coldResults</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">coldResults</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">warmAvg</span> <span class="o">=</span> <span class="nx">warmResults</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">warmResults</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">coldAverage</span><span class="p">:</span> <span class="nx">coldAvg</span><span class="p">,</span>
      <span class="na">warmAverage</span><span class="p">:</span> <span class="nx">warmAvg</span><span class="p">,</span>
      <span class="na">optimizationRatio</span><span class="p">:</span> <span class="nx">coldAvg</span> <span class="o">/</span> <span class="nx">warmAvg</span><span class="p">,</span>
      <span class="na">likelyOptimized</span><span class="p">:</span> <span class="p">(</span><span class="nx">coldAvg</span> <span class="o">/</span> <span class="nx">warmAvg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Demonstrate hidden class optimization</span>
  <span class="nx">demonstrateHiddenClasses</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ✅ Good: Consistent property order creates stable hidden classes</span>
    <span class="kd">function</span> <span class="nx">createPersonGood</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">,</span> <span class="nx">city</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>    <span class="c1">// Property 1</span>
        <span class="na">age</span><span class="p">:</span> <span class="nx">age</span><span class="p">,</span>      <span class="c1">// Property 2</span>
        <span class="na">city</span><span class="p">:</span> <span class="nx">city</span>     <span class="c1">// Property 3</span>
      <span class="p">};</span>
    <span class="p">}</span>
    
    <span class="c1">// ❌ Bad: Inconsistent property order creates multiple hidden classes</span>
    <span class="kd">function</span> <span class="nx">createPersonBad</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">,</span> <span class="nx">city</span><span class="p">,</span> <span class="nx">includeAge</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">name</span> <span class="p">};</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">includeAge</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">person</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">person</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">city</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">includeAge</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">person</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span> <span class="c1">// Different hidden class!</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">person</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Benchmark the difference</span>
    <span class="kd">const</span> <span class="nx">goodTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">createPersonGood</span><span class="p">(</span><span class="s2">`Name</span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="s2">`City</span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">badTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">createPersonBad</span><span class="p">(</span><span class="s2">`Name</span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="s2">`City</span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">goodTiming</span><span class="p">,</span>
      <span class="nx">badTiming</span><span class="p">,</span>
      <span class="na">performance</span><span class="p">:</span> <span class="nx">goodTiming</span> <span class="o">/</span> <span class="nx">badTiming</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Demonstrate inline caching</span>
  <span class="nx">demonstrateInlineCache</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Monomorphic inline cache (best performance)</span>
    <span class="kd">function</span> <span class="nx">processMonomorphic</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">value</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Polymorphic inline cache (decent performance)</span>
    <span class="kd">function</span> <span class="nx">processPolymorphic</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getValue</span> <span class="p">?</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="p">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Megamorphic inline cache (poor performance)</span>
    <span class="kd">function</span> <span class="nx">processMegamorphic</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">calculate</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="c1">// Test objects with same hidden class (monomorphic)</span>
    <span class="kd">const</span> <span class="nx">monoObjects</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="nx">i</span> <span class="p">}));</span>
    
    <span class="c1">// Test objects with different hidden classes (polymorphic)</span>
    <span class="kd">const</span> <span class="nx">polyObjects</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">i</span> <span class="p">};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="na">getValue</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="c1">// Test objects with many different shapes (megamorphic)</span>
    <span class="kd">const</span> <span class="nx">megaObjects</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">shapes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">calculate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">1</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">calculate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">calculate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">calculate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">calculate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">5</span> <span class="p">}</span>
      <span class="p">];</span>
      <span class="k">return</span> <span class="nx">shapes</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span><span class="p">];</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">monoTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">monoObjects</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">processMonomorphic</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">polyTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">polyObjects</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">processPolymorphic</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">megaTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">megaObjects</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">processMegamorphic</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">monomorphic</span><span class="p">:</span> <span class="nx">monoTiming</span><span class="p">,</span>
      <span class="na">polymorphic</span><span class="p">:</span> <span class="nx">polyTiming</span><span class="p">,</span>
      <span class="na">megamorphic</span><span class="p">:</span> <span class="nx">megaTiming</span><span class="p">,</span>
      <span class="na">ratios</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">polyToMono</span><span class="p">:</span> <span class="nx">polyTiming</span> <span class="o">/</span> <span class="nx">monoTiming</span><span class="p">,</span>
        <span class="na">megaToMono</span><span class="p">:</span> <span class="nx">megaTiming</span> <span class="o">/</span> <span class="nx">monoTiming</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Demonstrate optimizable vs non-optimizable patterns</span>
  <span class="nx">demonstrateOptimizationKillers</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ✅ Optimizable: Simple, predictable function</span>
    <span class="kd">function</span> <span class="nx">optimizable</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// ❌ Non-optimizable: Uses try/catch</span>
    <span class="kd">function</span> <span class="nx">nonOptimizableTryCatch</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// ❌ Non-optimizable: Uses eval</span>
    <span class="kd">function</span> <span class="nx">nonOptimizableEval</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2"> + </span><span class="p">${</span><span class="nx">y</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// ❌ Non-optimizable: Uses arguments object</span>
    <span class="kd">function</span> <span class="nx">nonOptimizableArguments</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// ✅ Optimizable: Uses rest parameters instead</span>
    <span class="kd">function</span> <span class="nx">optimizableRest</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{};</span>
    
    <span class="c1">// Benchmark each function</span>
    <span class="nx">results</span><span class="p">.</span><span class="nx">optimizable</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">optimizable</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">results</span><span class="p">.</span><span class="nx">nonOptimizableTryCatch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nonOptimizableTryCatch</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">results</span><span class="p">.</span><span class="nx">nonOptimizableEval</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Fewer iterations due to eval overhead</span>
        <span class="nx">nonOptimizableEval</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">results</span><span class="p">.</span><span class="nx">nonOptimizableArguments</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nonOptimizableArguments</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">results</span><span class="p">.</span><span class="nx">optimizableRest</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">optimizableRest</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Demonstrate number representation optimization</span>
  <span class="nx">demonstrateNumberOptimization</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// V8 uses different representations for numbers:</span>
    <span class="c1">// - Small integers (Smis): 31-bit signed integers on 32-bit, 32-bit on 64-bit</span>
    <span class="c1">// - Heap numbers: Double precision floating point</span>
    
    <span class="c1">// ✅ Smi range operations (fast)</span>
    <span class="kd">function</span> <span class="nx">smiOperations</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">i</span><span class="p">;</span> <span class="c1">// All operations within Smi range</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// ❌ Heap number operations (slower)</span>
    <span class="kd">function</span> <span class="nx">heapNumberOperations</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// Forces heap number representation</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// Test array access patterns</span>
    <span class="c1">// ✅ Packed array (fast)</span>
    <span class="kd">const</span> <span class="nx">packedArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">100000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span><span class="p">);</span>
    
    <span class="c1">// ❌ Holey array (slower)</span>
    <span class="kd">const</span> <span class="nx">holeyArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">100000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span><span class="p">);</span>
    <span class="k">delete</span> <span class="nx">holeyArray</span><span class="p">[</span><span class="mi">50000</span><span class="p">];</span> <span class="c1">// Creates a hole</span>
    
    <span class="kd">const</span> <span class="nx">smiTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(</span><span class="nx">smiOperations</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">heapTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(</span><span class="nx">heapNumberOperations</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">packedTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">packedArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">packedArray</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">holeyTiming</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">benchmarkFunction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">holeyArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">holeyArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">smi</span><span class="p">:</span> <span class="nx">smiTiming</span><span class="p">,</span>
      <span class="na">heapNumber</span><span class="p">:</span> <span class="nx">heapTiming</span><span class="p">,</span>
      <span class="na">packed</span><span class="p">:</span> <span class="nx">packedTiming</span><span class="p">,</span>
      <span class="na">holey</span><span class="p">:</span> <span class="nx">holeyTiming</span><span class="p">,</span>
      <span class="na">ratios</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">numberTypes</span><span class="p">:</span> <span class="nx">heapTiming</span> <span class="o">/</span> <span class="nx">smiTiming</span><span class="p">,</span>
        <span class="na">arrayTypes</span><span class="p">:</span> <span class="nx">holeyTiming</span> <span class="o">/</span> <span class="nx">packedTiming</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">benchmarkFunction</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">iterations</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">times</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="c1">// Warm up</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">fn</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="c1">// Measure</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">iterations</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      <span class="nx">fn</span><span class="p">();</span>
      <span class="nx">times</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// Return median time</span>
    <span class="nx">times</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">times</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">times</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)];</span>
  <span class="p">}</span>

  <span class="c1">// Monitor V8 heap and optimization status</span>
  <span class="nx">monitorV8Performance</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">monitor</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">heapUsage</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHeapUsage</span><span class="p">(),</span>
      <span class="na">optimizationHints</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOptimizationHints</span><span class="p">(),</span>
      <span class="na">performanceMarks</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">collectPerformanceMarks</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">monitor</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getHeapUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">memory</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">performance</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">used</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span><span class="p">,</span>
        <span class="na">total</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">totalJSHeapSize</span><span class="p">,</span>
        <span class="na">limit</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">jsHeapSizeLimit</span><span class="p">,</span>
        <span class="na">efficiency</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span> <span class="o">/</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">totalJSHeapSize</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getOptimizationHints</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="c1">// Common optimization hints</span>
      <span class="na">avoidOptimizationKillers</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">'</span><span class="s1">Avoid try/catch in hot functions</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Use consistent object shapes</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Prefer monomorphic call sites</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Avoid eval and with statements</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Use typed arrays for numeric data</span><span class="dl">'</span>
      <span class="p">],</span>
      
      <span class="c1">// V8 specific optimizations</span>
      <span class="na">v8Optimizations</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">'</span><span class="s1">Keep functions small and focused</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Avoid mixing number types</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Use packed arrays when possible</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Initialize objects with all properties</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Prefer rest parameters over arguments</span><span class="dl">'</span>
      <span class="p">]</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">collectPerformanceMarks</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">marks</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">mark</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">measures</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">measure</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">marks</span><span class="p">:</span> <span class="nx">marks</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">mark</span> <span class="o">=&gt;</span> <span class="p">({</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">mark</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">startTime</span><span class="p">:</span> <span class="nx">mark</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span>
        <span class="na">detail</span><span class="p">:</span> <span class="nx">mark</span><span class="p">.</span><span class="nx">detail</span>
      <span class="p">})),</span>
      <span class="na">measures</span><span class="p">:</span> <span class="nx">measures</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">measure</span> <span class="o">=&gt;</span> <span class="p">({</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">duration</span><span class="p">:</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span>
        <span class="na">startTime</span><span class="p">:</span> <span class="nx">measure</span><span class="p">.</span><span class="nx">startTime</span>
      <span class="p">}))</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="web-platform-apis-deep-dive">Web Platform APIs Deep Dive</h2>

<h3 id="storage-and-persistence-apis"><strong>Storage and Persistence APIs</strong></h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
</pre></td><td class="rouge-code"><pre><span class="c1">// Comprehensive storage API demonstration</span>
<span class="kd">class</span> <span class="nx">WebStorageManager</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">persistentStorage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initializeStorage</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">initializeStorage</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Check storage quota</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">storage</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span> <span class="o">&amp;&amp;</span> <span class="dl">'</span><span class="s1">estimate</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">estimate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Request persistent storage</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">storage</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span> <span class="o">&amp;&amp;</span> <span class="dl">'</span><span class="s1">persist</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">persistentStorage</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">persist</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Initialize IndexedDB</span>
    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">initializeIndexedDB</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// IndexedDB implementation</span>
  <span class="k">async</span> <span class="nx">initializeIndexedDB</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">indexedDB</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">AppDatabase</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      
      <span class="nx">request</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">);</span>
      <span class="p">};</span>
      
      <span class="nx">request</span><span class="p">.</span><span class="nx">onupgradeneeded</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        
        <span class="c1">// Create object stores</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">db</span><span class="p">.</span><span class="nx">objectStoreNames</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">userStore</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> 
            <span class="na">keyPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">autoIncrement</span><span class="p">:</span> <span class="kc">true</span> 
          <span class="p">});</span>
          <span class="nx">userStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">email</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">email</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
          <span class="nx">userStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">db</span><span class="p">.</span><span class="nx">objectStoreNames</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">cacheStore</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> 
            <span class="na">keyPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">url</span><span class="dl">'</span> 
          <span class="p">});</span>
          <span class="nx">cacheStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">timestamp</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">timestamp</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
          <span class="nx">cacheStore</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Advanced IndexedDB operations</span>
  <span class="k">async</span> <span class="nx">performComplexQuery</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">)</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">initializeIndexedDB</span><span class="p">();</span>
    
    <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">],</span> <span class="dl">'</span><span class="s1">readonly</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Range query</span>
    <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">IDBKeyRange</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="dl">'</span><span class="s1">A</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">M</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">index</span><span class="p">.</span><span class="nx">openCursor</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
      
      <span class="nx">request</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cursor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cursor</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
          <span class="nx">cursor</span><span class="p">.</span><span class="k">continue</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
      
      <span class="nx">request</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Cache API implementation</span>
  <span class="k">async</span> <span class="nx">initializeCacheAPI</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">caches</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">app-cache-v1</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="c1">// Advanced caching strategies</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">implementCachingStrategies</span><span class="p">(</span><span class="nx">cache</span><span class="p">);</span>
      
      <span class="k">return</span> <span class="nx">cache</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cache API not supported</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">implementCachingStrategies</span><span class="p">(</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Strategy 1: Cache First</span>
    <span class="kd">const</span> <span class="nx">cacheFirstHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="kd">const</span> <span class="nx">networkResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="c1">// Strategy 2: Network First</span>
    <span class="kd">const</span> <span class="nx">networkFirstHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">networkResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// Strategy 3: Stale While Revalidate</span>
    <span class="kd">const</span> <span class="nx">staleWhileRevalidateHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      
      <span class="kd">const</span> <span class="nx">networkPromise</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="nx">cachedResponse</span> <span class="o">||</span> <span class="nx">networkPromise</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="na">cacheFirst</span><span class="p">:</span> <span class="nx">cacheFirstHandler</span><span class="p">,</span>
      <span class="na">networkFirst</span><span class="p">:</span> <span class="nx">networkFirstHandler</span><span class="p">,</span>
      <span class="na">staleWhileRevalidate</span><span class="p">:</span> <span class="nx">staleWhileRevalidateHandler</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Web Locks API for resource coordination</span>
  <span class="k">async</span> <span class="nx">demonstrateWebLocks</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">locks</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Exclusive lock</span>
      <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">locks</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">resource-1</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">lock</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Acquired exclusive lock</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">performCriticalOperation</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Released exclusive lock</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// Shared lock</span>
      <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">locks</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">'</span><span class="s1">resource-2</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">shared</span><span class="dl">'</span> <span class="p">},</span> <span class="k">async</span> <span class="p">(</span><span class="nx">lock</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Acquired shared lock</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">performReadOperation</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Released shared lock</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// Query locks</span>
      <span class="kd">const</span> <span class="nx">lockState</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">locks</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">lockState</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Web Locks API not supported</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">performCriticalOperation</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Simulate critical operation</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">performReadOperation</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Simulate read operation</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">500</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Broadcast Channel API for cross-tab communication</span>
  <span class="nx">setupBroadcastChannel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">BroadcastChannel</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BroadcastChannel</span><span class="p">(</span><span class="dl">'</span><span class="s1">app-updates</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="nx">channel</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Received broadcast:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleBroadcastMessage</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// Send periodic updates</span>
      <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">channel</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">heartbeat</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
          <span class="na">tabId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getTabId</span><span class="p">()</span>
        <span class="p">});</span>
      <span class="p">},</span> <span class="mi">30000</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">channel</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">BroadcastChannel not supported</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleBroadcastMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">cache-invalidation</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">invalidateCache</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">keys</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">user-logout</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleUserLogout</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">theme-change</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateTheme</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">theme</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">getTabId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">tabId</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">tabId</span><span class="dl">'</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">tabId</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Background Sync for offline operations</span>
  <span class="k">async</span> <span class="nx">setupBackgroundSync</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span> <span class="o">&amp;&amp;</span> <span class="dl">'</span><span class="s1">sync</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ServiceWorkerRegistration</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">registration</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span><span class="p">;</span>
      
      <span class="c1">// Register for background sync</span>
      <span class="k">await</span> <span class="nx">registration</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">background-sync</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="c1">// Queue operations for sync</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">queueOperation</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">upload-data</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">offline data</span><span class="dl">'</span> <span class="p">},</span>
        <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
      <span class="p">});</span>
      
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">queueOperation</span><span class="p">(</span><span class="nx">operation</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Store operation in IndexedDB for background sync</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">)</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">initializeIndexedDB</span><span class="p">();</span>
    
    <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">],</span> <span class="dl">'</span><span class="s1">readwrite</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s2">`sync-operation-</span><span class="p">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">operation</span><span class="p">:</span> <span class="nx">operation</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">background-sync</span><span class="dl">'</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Storage cleanup and optimization</span>
  <span class="k">async</span> <span class="nx">optimizeStorage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">optimizations</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="c1">// Clean old cache entries</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">],</span> <span class="dl">'</span><span class="s1">readwrite</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="dl">'</span><span class="s1">timestamp</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="kd">const</span> <span class="nx">oneWeekAgo</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nx">IDBKeyRange</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">(</span><span class="nx">oneWeekAgo</span><span class="p">);</span>
      
      <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">index</span><span class="p">.</span><span class="nx">openCursor</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">deletedCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      
      <span class="nx">request</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cursor</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">cursor</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span>
          <span class="nx">deletedCount</span><span class="o">++</span><span class="p">;</span>
          <span class="nx">cursor</span><span class="p">.</span><span class="k">continue</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">};</span>
      
      <span class="nx">optimizations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`Deleted </span><span class="p">${</span><span class="nx">deletedCount</span><span class="p">}</span><span class="s2"> old cache entries`</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Clean localStorage</span>
    <span class="kd">const</span> <span class="nx">localStorageSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateLocalStorageSize</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">localStorageSize</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 5MB</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cleanupLocalStorage</span><span class="p">();</span>
      <span class="nx">optimizations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cleaned up localStorage</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Optimize Cache API</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">caches</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cacheNames</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">oldCaches</span> <span class="o">=</span> <span class="nx">cacheNames</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">name</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">v1</span><span class="dl">'</span><span class="p">));</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">cacheName</span> <span class="k">of</span> <span class="nx">oldCaches</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
        <span class="nx">optimizations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`Deleted old cache: </span><span class="p">${</span><span class="nx">cacheName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">optimizations</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">calculateLocalStorageSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">localStorage</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">totalSize</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">cleanupLocalStorage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">keysToRemove</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="nx">oneMonthAgo</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&lt;</span> <span class="nx">oneMonthAgo</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">keysToRemove</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Non-JSON data, check if it's old temporary data</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">temp_</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">keysToRemove</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">keysToRemove</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Generate storage report</span>
  <span class="k">async</span> <span class="nx">generateStorageReport</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">quota</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span><span class="p">,</span>
      <span class="na">persistent</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">persistentStorage</span><span class="p">,</span>
      <span class="na">usage</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">localStorage</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateLocalStorageSize</span><span class="p">(),</span>
        <span class="na">sessionStorage</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateSessionStorageSize</span><span class="p">(),</span>
        <span class="na">indexedDB</span><span class="p">:</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateIndexedDBSize</span><span class="p">(),</span>
        <span class="na">cacheAPI</span><span class="p">:</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateCacheAPISize</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="na">recommendations</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateStorageRecommendations</span><span class="p">()</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">report</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">calculateSessionStorageSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">sessionStorage</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">sessionStorage</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">totalSize</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">calculateIndexedDBSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// This is an approximation since there's no direct API</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">storeNames</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">cache</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">storeName</span> <span class="k">of</span> <span class="nx">storeNames</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">transaction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexedDB</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">storeName</span><span class="p">],</span> <span class="dl">'</span><span class="s1">readonly</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">objectStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">countRequest</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">count</span><span class="p">();</span>
      
      <span class="k">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">countRequest</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">countRequest</span><span class="p">.</span><span class="nx">result</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// Rough estimate</span>
          <span class="nx">resolve</span><span class="p">();</span>
        <span class="p">};</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">totalSize</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">calculateCacheAPISize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">'</span><span class="s1">caches</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">cacheNames</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">cacheName</span> <span class="k">of</span> <span class="nx">cacheNames</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">requests</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>
      <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">50000</span><span class="p">;</span> <span class="c1">// Rough estimate</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">totalSize</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">generateStorageRecommendations</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span><span class="p">.</span><span class="nx">usage</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">storageQuota</span><span class="p">.</span><span class="nx">quota</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Storage usage is high, consider cleanup</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">persistentStorage</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Request persistent storage for critical data</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Implement regular storage cleanup</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">Use appropriate storage for data lifecycle</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">recommendations</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This comprehensive guide covers the essential browser internals and web platform fundamentals necessary for understanding modern web development and optimizing frontend applications at the browser level.</p>

        </div>
    </article>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Study Resources</h3>
                    <p>Comprehensive collection of frontend interview questions, coding challenges, and system design problems.</p>
                </div>
                <div class="footer-section">
                    <h3>Progress Tracking</h3>
                    <p>Monitor your learning journey with detailed progress indicators and completion status.</p>
                </div>
                <div class="footer-section">
                    <h3>Big Tech Ready</h3>
                    <p>Curated content specifically designed for interviews at Google, Meta, Amazon, Apple, and Netflix.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Frontend Interview Hub. Built for aspiring frontend engineers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/assets/js/app.js"></script>
</body>
</html>