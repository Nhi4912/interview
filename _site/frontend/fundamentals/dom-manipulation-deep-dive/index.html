<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Manipulation: Complete Deep Dive | Frontend Interview Preparation Guide</title>
    <meta name="description" content="Comprehensive frontend interview materials for Big Tech companies">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="container">
            <div class="logo">Frontend Interview Hub</div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span aria-hidden="true">☰</span>
            </button>
            <ul class="nav-links" role="navigation" aria-label="Main navigation">
                <li><a href="/">Home</a></li>
                <li><a href="#progress">Progress</a></li>
                <li><a href="#knowledge">Knowledge</a></li>
                <li><a href="https://github.com/nee/interview" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="content-container">
    
        <nav class="breadcrumb">
            <ol>
                <li><a href="/">Home</a></li>
                
                
                
                    
                
                    
                        
                        
                            <li><a href="/frontend/">Frontend</a></li>
                        
                    
                
                    
                        
                        
                            <li><a href="/frontend/fundamentals/">Fundamentals</a></li>
                        
                    
                
                    
                        
                        
                            <li class="active">Dom manipulation: complete deep dive</li>
                        
                    
                
            </ol>
        </nav>
    
    
    <article class="content">
        
            <header class="content-header">
                <h1 class="content-title">DOM Manipulation: Complete Deep Dive</h1>
                
                
            </header>
        
        
        <div class="content-body">
            <h1 id="dom-manipulation-complete-deep-dive">DOM Manipulation: Complete Deep Dive</h1>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
  <li><a href="#understanding-the-dom">Understanding the DOM</a></li>
  <li><a href="#dom-tree-structure">DOM Tree Structure</a></li>
  <li><a href="#element-selection-methods">Element Selection Methods</a></li>
  <li><a href="#creating-and-modifying-elements">Creating and Modifying Elements</a></li>
  <li><a href="#event-system-deep-dive">Event System Deep Dive</a></li>
  <li><a href="#performance-optimization">Performance Optimization</a></li>
  <li><a href="#modern-dom-apis">Modern DOM APIs</a></li>
  <li><a href="#visual-diagrams">Visual Diagrams</a></li>
  <li><a href="#best-practices">Best Practices</a></li>
  <li><a href="#interview-questions--answers">Interview Questions &amp; Answers</a></li>
  <li><a href="#advanced-techniques">Advanced Techniques</a></li>
</ul>

<h2 id="understanding-the-dom">Understanding the DOM</h2>

<h3 id="what-is-the-dom">What is the DOM?</h3>

<p>The <strong>Document Object Model (DOM)</strong> is a programming interface for HTML and XML documents. It represents the document as a tree of objects that can be modified with JavaScript.</p>

<h4 id="key-concepts">Key Concepts:</h4>

<p><strong>1. Live Representation</strong></p>

<ul>
  <li>The DOM is a <strong>live</strong>, in-memory representation of the document</li>
  <li>Changes to the DOM immediately affect the rendered page</li>
  <li>JavaScript can read and modify the DOM in real-time</li>
</ul>

<p><strong>2. Object-Oriented Interface</strong></p>

<ul>
  <li>Every element, attribute, and piece of text is an <strong>object</strong></li>
  <li>Objects have properties and methods for manipulation</li>
  <li>Follows a hierarchical tree structure</li>
</ul>

<p><strong>3. Language-Agnostic API</strong></p>

<ul>
  <li>While commonly used with JavaScript, DOM APIs work with any language</li>
  <li>Standardized by W3C and WHATWG</li>
  <li>Consistent across different browsers (mostly)</li>
</ul>

<h3 id="dom-vs-html">DOM vs HTML</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c">&lt;!-- HTML Source Code --&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>My Page<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>Welcome to my page<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>HTML</strong>: Static markup language
<strong>DOM</strong>: Dynamic object representation</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// DOM Representation (simplified)</span>
<span class="p">{</span>
    <span class="nl">nodeType</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="c1">// DOCUMENT_NODE</span>
    <span class="nx">nodeName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#document</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">children</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="na">nodeType</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// ELEMENT_NODE</span>
            <span class="na">nodeName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">HTML</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">children</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">nodeType</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="na">nodeName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">HEAD</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">children</span><span class="p">:</span> <span class="p">[</span><span class="cm">/* title element */</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="na">nodeType</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="na">nodeName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">BODY</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">children</span><span class="p">:</span> <span class="p">[</span><span class="cm">/* h1 and p elements */</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="dom-tree-structure">DOM Tree Structure</h2>

<h3 id="node-types-and-hierarchy">Node Types and Hierarchy</h3>

<p>The DOM represents documents as a tree of <strong>nodes</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>                    document (Document Node)
                         │
                      html (Element Node)
                    ┌─────┴─────┐
                 head          body (Element Nodes)
                   │             │
               title          ┌───┴───┐
                 │          h1        p (Element Nodes)
           "My Page"         │        │
           (Text Node)  "Hello World" "Welcome..." (Text Nodes)
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="node-types-complete-list">Node Types (Complete List)</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="c1">// Node types with their numeric constants</span>
<span class="kd">const</span> <span class="nx">NODE_TYPES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">ELEMENT_NODE</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// &lt;div&gt;, &lt;span&gt;, etc.</span>
  <span class="na">ATTRIBUTE_NODE</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// class="example" (deprecated)</span>
  <span class="na">TEXT_NODE</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// Text content</span>
  <span class="na">CDATA_SECTION_NODE</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="c1">// &lt;![CDATA[...]]&gt;</span>
  <span class="na">ENTITY_REFERENCE_NODE</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1">// &amp;amp; (deprecated)</span>
  <span class="na">ENTITY_NODE</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">// (deprecated)</span>
  <span class="na">PROCESSING_INSTRUCTION_NODE</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="c1">// &lt;?xml-stylesheet ... ?&gt;</span>
  <span class="na">COMMENT_NODE</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="c1">// &lt;!-- comment --&gt;</span>
  <span class="na">DOCUMENT_NODE</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="c1">// document</span>
  <span class="na">DOCUMENT_TYPE_NODE</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1">// &lt;!DOCTYPE html&gt;</span>
  <span class="na">DOCUMENT_FRAGMENT_NODE</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="c1">// document.createDocumentFragment()</span>
  <span class="na">NOTATION_NODE</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="c1">// (deprecated)</span>
<span class="p">};</span>

<span class="c1">// Example usage</span>
<span class="kd">function</span> <span class="nx">analyzeNode</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">ELEMENT_NODE</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Element: </span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">TEXT_NODE</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Text: "</span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">COMMENT_NODE</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Comment: </span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Other node type: </span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="node-properties-and-relationships">Node Properties and Relationships</h3>

<p>Every DOM node has properties that describe its relationships:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1">// Node relationship properties</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myElement</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Parent relationships</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span> <span class="c1">// Immediate parent (any node type)</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">;</span> <span class="c1">// Parent element (null if parent isn't element)</span>

<span class="c1">// Child relationships</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span> <span class="c1">// All child nodes (including text, comments)</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span> <span class="c1">// Only child elements</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span> <span class="c1">// First child node</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">;</span> <span class="c1">// Last child node</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">;</span> <span class="c1">// First child element</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">lastElementChild</span><span class="p">;</span> <span class="c1">// Last child element</span>

<span class="c1">// Sibling relationships</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span> <span class="c1">// Next sibling node</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">previousSibling</span><span class="p">;</span> <span class="c1">// Previous sibling node</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span> <span class="c1">// Next sibling element</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span> <span class="c1">// Previous sibling element</span>

<span class="c1">// Document relationships</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">;</span> <span class="c1">// Reference to document</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">getRootNode</span><span class="p">();</span> <span class="c1">// Root node (document or shadow root)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="detailed-tree-navigation-example">Detailed Tree Navigation Example</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- This is a comment --&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Title<span class="nt">&lt;/h1&gt;</span>
  Some text content
  <span class="nt">&lt;p&gt;</span>Paragraph<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;span&gt;</span>Span element<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Understanding childNodes vs children</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 7 (includes text nodes and comment)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 3 (only h1, p, span elements)</span>

<span class="c1">// Iterating through all nodes</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">node</span> <span class="k">of</span> <span class="nx">container</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">ELEMENT_NODE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Element: </span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">TEXT_NODE</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Text: "</span><span class="p">${</span><span class="nx">text</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">COMMENT_NODE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Comment: </span><span class="p">${</span><span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Output:</span>
<span class="c1">// Comment: This is a comment</span>
<span class="c1">// Element: H1</span>
<span class="c1">// Text: "Some text content"</span>
<span class="c1">// Element: P</span>
<span class="c1">// Element: SPAN</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="element-selection-methods">Element Selection Methods</h2>

<h3 id="performance-comparison-of-selection-methods">Performance Comparison of Selection Methods</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1">// Performance ranking (fastest to slowest)</span>
<span class="c1">// 1. getElementById - O(1) hash lookup</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myId</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// 2. getElementsByTagName - optimized native implementation</span>
<span class="kd">const</span> <span class="nx">paragraphs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// 3. getElementsByClassName - optimized for class selection</span>
<span class="kd">const</span> <span class="nx">highlighted</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">highlight</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// 4. querySelector - flexible but slower for simple selections</span>
<span class="kd">const</span> <span class="nx">firstParagraph</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// 5. querySelectorAll - most flexible but slowest</span>
<span class="kd">const</span> <span class="nx">allParagraphs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="advanced-selector-strategies">Advanced Selector Strategies</h3>

<p><strong>1. Context-Specific Selection</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// Instead of searching entire document</span>
<span class="kd">const</span> <span class="nx">expensiveSearch</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.item .title</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Search within a specific container</span>
<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">itemContainer</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">efficientSearch</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.title</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Even better: use more specific selectors</span>
<span class="kd">const</span> <span class="nx">verySpecific</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">#itemContainer &gt; .item &gt; .title</span><span class="dl">"</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. Live vs Static Collections</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">// Live collections (automatically update)</span>
<span class="kd">const</span> <span class="nx">liveCollection</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">dynamic</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">liveCollection</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 3</span>

<span class="c1">// Add new element with class 'dynamic'</span>
<span class="kd">const</span> <span class="nx">newElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">newElement</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">dynamic</span><span class="dl">"</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newElement</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">liveCollection</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 4 (automatically updated!)</span>

<span class="c1">// Static collections (snapshot at query time)</span>
<span class="kd">const</span> <span class="nx">staticCollection</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.dynamic</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">staticCollection</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// 3 (doesn't change)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3. Custom Selection Utilities</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DOMSelector</span> <span class="p">{</span>
  <span class="c1">// Enhanced getElementById with error handling</span>
  <span class="kd">static</span> <span class="nx">byId</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">context</span> <span class="o">=</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`Element with id "</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">" not found`</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Get element with data attribute</span>
  <span class="kd">static</span> <span class="nx">byData</span><span class="p">(</span><span class="nx">attribute</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">context</span> <span class="o">=</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">`[data-</span><span class="p">${</span><span class="nx">attribute</span><span class="p">}</span><span class="s2">="</span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">"]`</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Get all elements matching multiple classes</span>
  <span class="kd">static</span> <span class="nx">byClasses</span><span class="p">(</span><span class="nx">classes</span><span class="p">,</span> <span class="nx">context</span> <span class="o">=</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">selector</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">cls</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`.</span><span class="p">${</span><span class="nx">cls</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Get closest ancestor matching selector</span>
  <span class="kd">static</span> <span class="nx">closest</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Get all descendants matching selector</span>
  <span class="kd">static</span> <span class="nx">descendants</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Check if element matches selector</span>
  <span class="kd">static</span> <span class="nx">matches</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage examples</span>
<span class="kd">const</span> <span class="nx">header</span> <span class="o">=</span> <span class="nx">DOMSelector</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="dl">"</span><span class="s2">header</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">dataElement</span> <span class="o">=</span> <span class="nx">DOMSelector</span><span class="p">.</span><span class="nx">byData</span><span class="p">(</span><span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">multiClass</span> <span class="o">=</span> <span class="nx">DOMSelector</span><span class="p">.</span><span class="nx">byClasses</span><span class="p">([</span><span class="dl">"</span><span class="s2">btn</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">primary</span><span class="dl">"</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">parentSection</span> <span class="o">=</span> <span class="nx">DOMSelector</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="nx">button</span><span class="p">,</span> <span class="dl">"</span><span class="s2">section</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="creating-and-modifying-elements">Creating and Modifying Elements</h2>

<h3 id="element-creation-patterns">Element Creation Patterns</h3>

<p><strong>1. Basic Element Creation</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">// Create element</span>
<span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Set attributes</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">myDiv</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">container highlight</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-role</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">content</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Set content</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello World</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;strong&gt;Bold text&lt;/strong&gt;</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Append to document</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. Advanced Element Factory</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">ElementFactory</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">tagName</span><span class="p">);</span>

    <span class="c1">// Set attributes</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">attributes</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Set properties</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">properties</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set styles</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">styles</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">styles</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Set content</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">textContent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Add event listeners</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">events</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="c1">// Add children</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">child</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">child</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">child</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Specialized creation methods</span>
  <span class="kd">static</span> <span class="nx">button</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">onClick</span><span class="p">,</span> <span class="nx">className</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">btn</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">textContent</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span> <span class="nx">className</span> <span class="p">},</span>
      <span class="na">events</span><span class="p">:</span> <span class="p">{</span> <span class="na">click</span><span class="p">:</span> <span class="nx">onClick</span> <span class="p">},</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">input</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">,</span> <span class="nx">name</span> <span class="p">},</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">div</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span> <span class="nx">className</span> <span class="p">},</span>
      <span class="na">innerHTML</span><span class="p">:</span> <span class="nx">content</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">ElementFactory</span><span class="p">.</span><span class="nx">button</span><span class="p">(</span><span class="dl">"</span><span class="s2">Click me</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Clicked!</span><span class="dl">"</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">ElementFactory</span><span class="p">.</span><span class="nx">input</span><span class="p">(</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Enter name...</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">ElementFactory</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="dl">"</span><span class="s2">form-container</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="document-fragments-for-performance">Document Fragments for Performance</h3>

<p><strong>Problem: Multiple DOM Manipulations</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1">// SLOW: Each appendChild causes reflow</span>
<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// Reflow on each iteration!</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Solution: Document Fragment</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// FAST: Only one reflow at the end</span>
<span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// No reflow</span>
<span class="p">}</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span> <span class="c1">// Single reflow</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Advanced Fragment Usage</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DOMBatchProcessor</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">operations</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>

  <span class="c1">// Queue element creation</span>
  <span class="nx">createElement</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">ElementFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">element</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Queue existing element</span>
  <span class="nx">addElement</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Commit all changes at once</span>
  <span class="nx">commitTo</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span> <span class="c1">// Reset</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Create multiple similar elements</span>
  <span class="nx">createMultiple</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">tagName</span><span class="p">,</span> <span class="nx">optionsGenerator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span>
        <span class="k">typeof</span> <span class="nx">optionsGenerator</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">function</span><span class="dl">"</span>
          <span class="p">?</span> <span class="nx">optionsGenerator</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
          <span class="p">:</span> <span class="nx">optionsGenerator</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">tagName</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">processor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMBatchProcessor</span><span class="p">();</span>

<span class="nx">processor</span>
  <span class="p">.</span><span class="nx">createMultiple</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="na">textContent</span><span class="p">:</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="na">properties</span><span class="p">:</span> <span class="p">{</span> <span class="na">className</span><span class="p">:</span> <span class="dl">"</span><span class="s2">list-item</span><span class="dl">"</span> <span class="p">},</span>
    <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">data-index</span><span class="dl">"</span><span class="p">:</span> <span class="nx">index</span> <span class="p">},</span>
  <span class="p">}))</span>
  <span class="p">.</span><span class="nx">commitTo</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">));</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="event-system-deep-dive">Event System Deep Dive</h2>

<h3 id="event-flow-capturing-target-bubbling">Event Flow: Capturing, Target, Bubbling</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre>Event Flow Phases:

Phase 1: CAPTURING (top-down)
┌─────────────────────────────────────┐
│            document                 │
│  ┌─────────────────────────────┐    │
│  │           html              │ ←──┼── Event travels down
│  │  ┌─────────────────────┐    │    │
│  │  │        body         │ ←──┼────┤
│  │  │  ┌─────────────┐    │    │    │
│  │  │  │    div      │ ←──┼────┼────┤
│  │  │  │  ┌─────┐    │    │    │    │
│  │  │  │  │ btn │ ←──┼────┼────┼────┘
│  │  │  │  └─────┘    │    │    │
│  │  │  └─────────────┘    │    │
│  │  └─────────────────────┘    │
│  └─────────────────────────────┘
└─────────────────────────────────────┘

Phase 2: TARGET
Button receives the event

Phase 3: BUBBLING (bottom-up)
┌─────────────────────────────────────┐
│            document                 │
│  ┌─────────────────────────────┐    │
│  │           html              │ ←──┼── Event bubbles up
│  │  ┌─────────────────────┐    │    │
│  │  │        body         │ ←──┼────┤
│  │  │  ┌─────────────┐    │    │    │
│  │  │  │    div      │ ←──┼────┼────┤
│  │  │  │  ┌─────┐    │    │    │    │
│  │  │  │  │ btn │ ←──┼────┼────┼────┘
│  │  │  │  └─────┘    │    │    │
│  │  │  └─────────────┘    │    │
│  │  └─────────────────────┘    │
│  └─────────────────────────────┘
└─────────────────────────────────────┘
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="event-handling-patterns">Event Handling Patterns</h3>

<p><strong>1. Event Delegation</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre></td><td class="rouge-code"><pre><span class="c1">// Instead of adding listeners to many elements</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.button</span><span class="dl">"</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">button</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">handleButtonClick</span><span class="p">);</span> <span class="c1">// Many listeners</span>
<span class="p">});</span>

<span class="c1">// Use event delegation on parent</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="dl">"</span><span class="s2">.button</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">handleButtonClick</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Advanced event delegation</span>
<span class="kd">class</span> <span class="nx">EventDelegator</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span>
      <span class="k">typeof</span> <span class="nx">container</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span>
        <span class="p">?</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
        <span class="p">:</span> <span class="nx">container</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>

    <span class="c1">// Single listener for all events</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">change</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleInput</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Register handler for specific selector</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">eventType</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">eventType</span><span class="p">).</span><span class="kd">set</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Handle delegated events</span>
  <span class="nx">handleEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">eventHandlers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">eventHandlers</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="c1">// Check each selector</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">handler</span><span class="p">]</span> <span class="k">of</span> <span class="nx">eventHandlers</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">handler</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span> <span class="c1">// Stop at first match</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">handleChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">handleInput</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">delegator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventDelegator</span><span class="p">(</span><span class="dl">"</span><span class="s2">#app</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">delegator</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.btn</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Button clicked:</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.link</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Link clicked:</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.search</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Search input:</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. Custom Event System</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">CustomEventEmitter</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Emit custom event</span>
  <span class="nx">emit</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">detail</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">detail</span><span class="p">,</span>
      <span class="na">bubbles</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">cancelable</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">event</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Listen for custom events</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// Store for cleanup</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">eventType</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">eventType</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Remove specific listener</span>
  <span class="nx">off</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">eventType</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">eventType</span><span class="p">).</span><span class="k">delete</span><span class="p">(</span><span class="nx">handler</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Remove all listeners for event type</span>
  <span class="nx">offAll</span><span class="p">(</span><span class="nx">eventType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">eventType</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">handler</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">eventType</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">eventType</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Cleanup all listeners</span>
  <span class="nx">destroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">]</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">handler</span> <span class="k">of</span> <span class="nx">handlers</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEventEmitter</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myComponent</span><span class="dl">"</span><span class="p">));</span>

<span class="c1">// Listen for custom events</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">dataLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Data loaded:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">statusChanged</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Status changed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Emit custom events</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">dataLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">statusChanged</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ready</span><span class="dl">"</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="event-performance-optimization">Event Performance Optimization</h3>

<p><strong>1. Throttling and Debouncing Events</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">EventOptimizer</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">throttle</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">inThrottle</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inThrottle</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="nx">inThrottle</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">inThrottle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">),</span> <span class="nx">limit</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="nx">debounce</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">timeoutId</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>
      <span class="nx">timeoutId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">),</span> <span class="nx">delay</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Smart event optimization</span>
  <span class="kd">static</span> <span class="nx">optimize</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">throttle</span><span class="p">,</span> <span class="nx">debounce</span><span class="p">,</span> <span class="nx">passive</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>

    <span class="kd">let</span> <span class="nx">optimizedHandler</span> <span class="o">=</span> <span class="nx">handler</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">throttle</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">optimizedHandler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">throttle</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">throttle</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">debounce</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">optimizedHandler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">debounce</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">debounce</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">optimizedHandler</span><span class="p">,</span> <span class="p">{</span> <span class="nx">passive</span> <span class="p">});</span>

    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">optimizedHandler</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">scrollHandler</span> <span class="o">=</span> <span class="nx">EventOptimizer</span><span class="p">.</span><span class="nx">optimize</span><span class="p">(</span>
  <span class="nb">window</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">scroll</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Scrolled!</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">throttle</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">searchHandler</span> <span class="o">=</span> <span class="nx">EventOptimizer</span><span class="p">.</span><span class="nx">optimize</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">search</span><span class="dl">"</span><span class="p">),</span>
  <span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">performSearch</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">),</span>
  <span class="p">{</span> <span class="na">debounce</span><span class="p">:</span> <span class="mi">300</span> <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="performance-optimization">Performance Optimization</h2>

<h3 id="reflow-and-repaint-optimization">Reflow and Repaint Optimization</h3>

<p><strong>Understanding Browser Rendering Pipeline:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>1. Layout (Reflow) - Calculate positions and dimensions
2. Paint - Fill in pixels for each element
3. Composite - Combine layers for final image
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Properties that trigger reflows:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code>, <code class="language-plaintext highlighter-rouge">margin</code>, <code class="language-plaintext highlighter-rouge">padding</code></li>
  <li><code class="language-plaintext highlighter-rouge">border</code>, <code class="language-plaintext highlighter-rouge">position</code>, <code class="language-plaintext highlighter-rouge">top</code>, <code class="language-plaintext highlighter-rouge">left</code></li>
  <li><code class="language-plaintext highlighter-rouge">font-size</code>, <code class="language-plaintext highlighter-rouge">line-height</code></li>
  <li><code class="language-plaintext highlighter-rouge">display</code>, <code class="language-plaintext highlighter-rouge">float</code></li>
</ul>

<p><strong>Properties that only trigger repaints:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">color</code>, <code class="language-plaintext highlighter-rouge">background-color</code></li>
  <li><code class="language-plaintext highlighter-rouge">visibility</code></li>
  <li><code class="language-plaintext highlighter-rouge">outline</code></li>
</ul>

<p><strong>Properties that only trigger composite:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">transform</code>, <code class="language-plaintext highlighter-rouge">opacity</code></li>
  <li><code class="language-plaintext highlighter-rouge">filter</code></li>
</ul>

<p><strong>Optimization Strategies:</strong></p>

<p><strong>1. Batch DOM Reads and Writes</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// BAD: Causes multiple reflows</span>
<span class="kd">function</span> <span class="nx">badExample</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myDiv</span><span class="dl">"</span><span class="p">);</span>

  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">100px</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Write - triggers reflow</span>
  <span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span> <span class="c1">// Read - forces reflow</span>

  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">200px</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Write - triggers reflow</span>
  <span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span> <span class="c1">// Read - forces reflow</span>
<span class="p">}</span>

<span class="c1">// GOOD: Batch reads and writes</span>
<span class="kd">function</span> <span class="nx">goodExample</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myDiv</span><span class="dl">"</span><span class="p">);</span>

  <span class="c1">// Batch all reads first</span>
  <span class="kd">const</span> <span class="nx">currentHeight</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">currentWidth</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>

  <span class="c1">// Then batch all writes</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">100px</span><span class="dl">"</span><span class="p">;</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">200px</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. Use CSS Classes Instead of Inline Styles</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// BAD: Multiple style changes</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">200px</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">100px</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">red</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1px solid black</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// GOOD: Single class change</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">optimized-style</span><span class="dl">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3. Virtualization for Large Lists</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">VirtualList</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">items</span><span class="p">,</span> <span class="nx">itemHeight</span><span class="p">,</span> <span class="nx">visibleCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">container</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="nx">items</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span> <span class="o">=</span> <span class="nx">itemHeight</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleCount</span> <span class="o">=</span> <span class="nx">visibleCount</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create container for all items (sets scroll height)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">totalHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">visibleCount</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">auto</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Create viewport</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">totalHeight</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">relative</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Create visible items container</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">absolute</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">100%</span><span class="dl">"</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewport</span><span class="p">);</span>

    <span class="c1">// Handle scrolling</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">scroll</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">endIndex</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
      <span class="nx">startIndex</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">visibleCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">);</span>

    <span class="c1">// Clear current items</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>

    <span class="c1">// Render visible items</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">startIndex</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">endIndex</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">);</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">absolute</span><span class="dl">"</span><span class="p">;</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">i</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">itemHeight</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">visibleContainer</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">createItem</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1px solid #ccc</span><span class="dl">"</span><span class="p">;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">padding</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10px</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage for 10,000 items (only renders visible ones)</span>
<span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">10000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`Data </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">virtualList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VirtualList</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">list-container</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">items</span><span class="p">,</span>
  <span class="mi">50</span><span class="p">,</span> <span class="c1">// item height</span>
  <span class="mi">20</span> <span class="c1">// visible count</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="modern-dom-apis">Modern DOM APIs</h2>

<h3 id="intersection-observer">Intersection Observer</h3>

<p><strong>Observing element visibility:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">VisibilityManager</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">observe</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">root</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="na">rootMargin</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0px</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">threshold</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">finalOptions</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="p">...</span><span class="nx">options</span> <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IntersectionObserver</span><span class="p">((</span><span class="nx">entries</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span><span class="p">,</span> <span class="nx">entry</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span> <span class="nx">finalOptions</span><span class="p">);</span>

    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">observer</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">unobserve</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">disconnect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">observer</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage: Lazy loading images</span>
<span class="kd">const</span> <span class="nx">visibilityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VisibilityManager</span><span class="p">();</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">img[data-src]</span><span class="dl">"</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">img</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">visibilityManager</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">isVisible</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isVisible</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>
      <span class="nx">element</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-src</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">visibilityManager</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="resizeobserver">ResizeObserver</h3>

<p><strong>Responding to element size changes:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">ResponsiveComponent</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">breakpoints</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">small</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
      <span class="na">medium</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
      <span class="na">large</span><span class="p">:</span> <span class="mi">900</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resizeObserver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResizeObserver</span><span class="p">((</span><span class="nx">entries</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handleResize</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">resizeObserver</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleResize</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">width</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">contentRect</span><span class="p">;</span>

    <span class="c1">// Remove all size classes</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">"</span><span class="s2">small</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">medium</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">large</span><span class="dl">"</span><span class="p">);</span>

    <span class="c1">// Add appropriate class based on width</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">breakpoints</span><span class="p">.</span><span class="nx">small</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">small</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">breakpoints</span><span class="p">.</span><span class="nx">medium</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">medium</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">large</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Emit custom event</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span>
      <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="dl">"</span><span class="s2">sizeChanged</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">detail</span><span class="p">:</span> <span class="p">{</span> <span class="nx">width</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">contentRect</span><span class="p">.</span><span class="nx">height</span> <span class="p">},</span>
      <span class="p">})</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">destroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resizeObserver</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">responsiveComponent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResponsiveComponent</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">responsive-element</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="mutationobserver">MutationObserver</h3>

<p><strong>Watching DOM changes:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">DOMWatcher</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">watch</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">defaultOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">subtree</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">attributes</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">attributeOldValue</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">characterData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">characterDataOldValue</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">finalOptions</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">defaultOptions</span><span class="p">,</span> <span class="p">...</span><span class="nx">options</span> <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">((</span><span class="nx">mutations</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">mutations</span><span class="p">,</span> <span class="nx">observer</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">finalOptions</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">observer</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">unwatch</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">unwatch</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">disconnect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">observer</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage: Auto-save when content changes</span>
<span class="kd">const</span> <span class="nx">watcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMWatcher</span><span class="p">();</span>

<span class="nx">watcher</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">editor</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">mutations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">mutation</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">childList</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">characterData</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content changed, auto-saving...</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">autoSave</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">characterData</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="interview-questions--answers">Interview Questions &amp; Answers</h2>

<h3 id="q1-whats-the-difference-between-innerhtml-textcontent-and-innertext">Q1: What’s the difference between <code class="language-plaintext highlighter-rouge">innerHTML</code>, <code class="language-plaintext highlighter-rouge">textContent</code>, and <code class="language-plaintext highlighter-rouge">innerText</code>?</h3>

<p><strong>Answer:</strong></p>

<p><strong>innerHTML</strong>:</p>

<ul>
  <li>Gets/sets HTML content including tags</li>
  <li>Parses HTML and creates DOM nodes</li>
  <li>Can execute scripts (security risk)</li>
  <li>Triggers reflow and repaint</li>
</ul>

<p><strong>textContent</strong>:</p>

<ul>
  <li>Gets/sets only text content</li>
  <li>Ignores HTML tags</li>
  <li>Includes hidden elements</li>
  <li>Faster than innerText</li>
</ul>

<p><strong>innerText</strong>:</p>

<ul>
  <li>Gets/sets visible text content</li>
  <li>Respects styling (hidden elements ignored)</li>
  <li>Triggers reflow to calculate visibility</li>
  <li>Slower than textContent</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>
  <span class="dl">'</span><span class="s1">&lt;span style="display:none"&gt;Hidden&lt;/span&gt;&lt;strong&gt;Visible&lt;/strong&gt;</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">);</span> <span class="c1">// '&lt;span style="display:none"&gt;Hidden&lt;/span&gt;&lt;strong&gt;Visible&lt;/strong&gt;'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span> <span class="c1">// 'HiddenVisible'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">div</span><span class="p">.</span><span class="nx">innerText</span><span class="p">);</span> <span class="c1">// 'Visible' (hidden span ignored)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="q2-explain-event-bubbling-and-capturing-with-an-example">Q2: Explain event bubbling and capturing with an example.</h3>

<p><strong>Answer:</strong></p>

<p>Event propagation occurs in three phases:</p>

<ol>
  <li><strong>Capturing phase</strong>: Event travels from document to target</li>
  <li><strong>Target phase</strong>: Event reaches the target element</li>
  <li><strong>Bubbling phase</strong>: Event travels from target back to document</li>
</ol>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"outer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"inner"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"button"</span><span class="nt">&gt;</span>Click me<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="c1">// Capturing listeners (third parameter = true)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">outer</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Outer captured</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="kc">true</span>
<span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">inner</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Inner captured</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="kc">true</span>
<span class="p">);</span>

<span class="c1">// Bubbling listeners (default)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Button clicked</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">inner</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Inner bubbled</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">outer</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Outer bubbled</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// When button is clicked, output:</span>
<span class="c1">// Outer captured</span>
<span class="c1">// Inner captured</span>
<span class="c1">// Button clicked</span>
<span class="c1">// Inner bubbled</span>
<span class="c1">// Outer bubbled</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="q3-how-would-you-implement-efficient-dom-manipulation-for-adding-1000-elements">Q3: How would you implement efficient DOM manipulation for adding 1000 elements?</h3>

<p><strong>Answer:</strong></p>

<p><strong>Bad approach (causes 1000 reflows):</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// Reflow on each append</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Good approaches:</strong></p>

<p><strong>1. Document Fragment:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">`Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span> <span class="c1">// Single reflow</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. innerHTML with array join:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">html</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">`&lt;div&gt;Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">&lt;/div&gt;`</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span> <span class="c1">// Single reflow</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3. Template strings:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">},</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s2">`&lt;div&gt;Item </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">&lt;/div&gt;`</span><span class="p">);</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="q4-what-are-the-performance-implications-of-different-dom-querying-methods">Q4: What are the performance implications of different DOM querying methods?</h3>

<p><strong>Answer:</strong></p>

<p><strong>Performance ranking (fastest to slowest):</strong></p>

<ol>
  <li><strong>getElementById()</strong> - O(1) hash lookup</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myId</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Fastest</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li><strong>getElementsByTagName()</strong> - Optimized native implementation</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Fast, returns live collection</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li><strong>getElementsByClassName()</strong> - Optimized for classes</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">myClass</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Fast, returns live collection</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li><strong>querySelector()</strong> - CSS selector engine (returns first match)</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.myClass</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Slower, more flexible</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li><strong>querySelectorAll()</strong> - CSS selector engine (returns all matches)</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.myClass</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Slowest, most flexible</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Optimization strategies:</strong></p>

<ul>
  <li>Cache DOM references</li>
  <li>Use specific selectors</li>
  <li>Limit scope with context</li>
  <li>Prefer native methods for simple selections</li>
</ul>

<h3 id="q5-how-do-you-prevent-memory-leaks-in-dom-manipulation">Q5: How do you prevent memory leaks in DOM manipulation?</h3>

<p><strong>Answer:</strong></p>

<p><strong>Common causes and solutions:</strong></p>

<p><strong>1. Event listeners not removed:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1">// PROBLEM: Memory leak</span>
<span class="kd">function</span> <span class="nx">attachHandler</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">1000000</span><span class="p">);</span> <span class="c1">// Large data</span>

  <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// Keeps data in memory</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// SOLUTION: Proper cleanup</span>
<span class="kd">function</span> <span class="nx">attachHandler</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">clickHandler</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Clicked</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">clickHandler</span><span class="p">);</span>

  <span class="c1">// Return cleanup function</span>
  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">button</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">clickHandler</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">cleanup</span> <span class="o">=</span> <span class="nx">attachHandler</span><span class="p">();</span>
<span class="c1">// Later: cleanup();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>2. Circular references:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1">// PROBLEM: Circular reference</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">myElement</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">myProperty</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">element</span><span class="p">:</span> <span class="nx">element</span><span class="p">,</span> <span class="c1">// Circular reference</span>
  <span class="na">data</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
<span class="p">};</span>

<span class="c1">// SOLUTION: Use WeakMap</span>
<span class="kd">const</span> <span class="nx">elementData</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">WeakMap</span><span class="p">();</span>
<span class="nx">elementData</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
<span class="p">});</span>
<span class="c1">// When element is removed, data is automatically garbage collected</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>3. Detached DOM nodes:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// PROBLEM: References to removed DOM nodes</span>
<span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">function</span> <span class="nx">cacheElement</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">.temp</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">cache</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span> <span class="c1">// Keeps element in memory even after removal</span>
<span class="p">}</span>

<span class="c1">// SOLUTION: Clear references</span>
<span class="kd">function</span> <span class="nx">clearCache</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cache</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="additional-advanced-interview-qa-and-visuals">Additional Advanced Interview Q&amp;A and Visuals</h1>

<h2 id="q-how-do-you-prevent-xss-when-updating-the-dom-with-user-input">Q: How do you prevent XSS when updating the DOM with user input?</h2>

<p><strong>Answer (English):</strong></p>

<ul>
  <li>Never use <code class="language-plaintext highlighter-rouge">innerHTML</code> with untrusted data</li>
  <li>Use <code class="language-plaintext highlighter-rouge">textContent</code> or DOM methods</li>
  <li>Sanitize input with libraries (e.g., DOMPurify)</li>
</ul>

<p><strong>Answer (Vietnamese):</strong></p>

<ul>
  <li>Không dùng <code class="language-plaintext highlighter-rouge">innerHTML</code> với dữ liệu không tin cậy</li>
  <li>Dùng <code class="language-plaintext highlighter-rouge">textContent</code> hoặc các phương thức DOM</li>
  <li>Làm sạch dữ liệu với thư viện (ví dụ DOMPurify)</li>
</ul>

<hr />

<h2 id="diagram-dom-event-propagation-capture--bubble">Diagram: DOM Event Propagation (Capture &amp; Bubble)</h2>

<pre><code class="language-mermaid">sequenceDiagram
  participant Document
  participant OuterDiv
  participant InnerDiv
  participant Button

  Document-&gt;&gt;OuterDiv: Capturing
  OuterDiv-&gt;&gt;InnerDiv: Capturing
  InnerDiv-&gt;&gt;Button: Capturing
  Button--&gt;&gt;InnerDiv: Bubbling
  InnerDiv--&gt;&gt;OuterDiv: Bubbling
  OuterDiv--&gt;&gt;Document: Bubbling
</code></pre>

<hr />

<h2 id="q-how-would-you-optimize-rendering-performance-in-a-large-dom-tree">Q: How would you optimize rendering performance in a large DOM tree?</h2>

<p><strong>Answer (English):</strong></p>

<ul>
  <li>Minimize reflows by batching DOM changes (use DocumentFragment, innerHTML with join, or requestAnimationFrame)</li>
  <li>Use virtual DOM or offscreen rendering for complex UIs</li>
  <li>Avoid layout thrashing (read/write DOM in separate phases)</li>
  <li>Use efficient selectors and cache references</li>
</ul>

<p><strong>Answer (Vietnamese):</strong></p>

<ul>
  <li>Giảm reflow bằng cách gộp thay đổi DOM (dùng DocumentFragment, innerHTML với join, hoặc requestAnimationFrame)</li>
  <li>Dùng virtual DOM hoặc render offscreen cho UI phức tạp</li>
  <li>Tránh layout thrashing (đọc/ghi DOM ở các phase riêng)</li>
  <li>Dùng selector hiệu quả và cache tham chiếu</li>
</ul>

<hr />

<p>This comprehensive guide covers DOM manipulation from fundamental concepts to advanced optimization techniques, providing the deep understanding needed for senior frontend engineering interviews.</p>

        </div>
    </article>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Study Resources</h3>
                    <p>Comprehensive collection of frontend interview questions, coding challenges, and system design problems.</p>
                </div>
                <div class="footer-section">
                    <h3>Progress Tracking</h3>
                    <p>Monitor your learning journey with detailed progress indicators and completion status.</p>
                </div>
                <div class="footer-section">
                    <h3>Big Tech Ready</h3>
                    <p>Curated content specifically designed for interviews at Google, Meta, Amazon, Apple, and Netflix.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Frontend Interview Hub. Built for aspiring frontend engineers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/assets/js/app.js"></script>
</body>
</html>