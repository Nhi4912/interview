<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê Network Protocols Deep Dive | Frontend Interview Preparation Guide</title>
    <meta name="description" content="Comprehensive frontend interview materials for Big Tech companies">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="container">
            <div class="logo">Frontend Interview Hub</div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span aria-hidden="true">‚ò∞</span>
            </button>
            <ul class="nav-links" role="navigation" aria-label="Main navigation">
                <li><a href="/">Home</a></li>
                <li><a href="#progress">Progress</a></li>
                <li><a href="#knowledge">Knowledge</a></li>
                <li><a href="https://github.com/nee/interview" target="_blank" rel="noopener">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="content-container">
    
        <nav class="breadcrumb">
            <ol>
                <li><a href="/">Home</a></li>
                
                
                
                    
                
                    
                        
                        
                            <li><a href="/theory-and-visuals/">Theory and visuals</a></li>
                        
                    
                
                    
                        
                        
                            <li class="active">üåê network protocols deep dive</li>
                        
                    
                
            </ol>
        </nav>
    
    
    <article class="content">
        
            <header class="content-header">
                <h1 class="content-title">üåê Network Protocols Deep Dive</h1>
                
                
            </header>
        
        
        <div class="content-body">
            <h1 id="-network-protocols-deep-dive">üåê Network Protocols Deep Dive</h1>

<h2 id="-table-of-contents">üìã Table of Contents</h2>

<ul>
  <li><a href="#httphttps-fundamentals">HTTP/HTTPS Fundamentals</a></li>
  <li><a href="#websocket-protocol">WebSocket Protocol</a></li>
  <li><a href="#http2--http3">HTTP/2 &amp; HTTP/3</a></li>
  <li><a href="#caching-strategies">Caching Strategies</a></li>
  <li><a href="#security-protocols">Security Protocols</a></li>
  <li><a href="#performance-optimization">Performance Optimization</a></li>
  <li><a href="#visual-diagrams">Visual Diagrams</a></li>
</ul>

<h2 id="-httphttps-fundamentals">üåç HTTP/HTTPS Fundamentals</h2>

<h3 id="http-requestresponse-flow">HTTP Request/Response Flow</h3>

<pre><code class="language-mermaid">sequenceDiagram
    participant Client
    participant DNS
    participant Server
    participant CDN

    Client-&gt;&gt;DNS: DNS Lookup
    DNS--&gt;&gt;Client: IP Address
    Client-&gt;&gt;Server: TCP Connection
    Server--&gt;&gt;Client: Connection Established
    Client-&gt;&gt;Server: HTTP Request
    Server-&gt;&gt;CDN: Check Cache
    CDN--&gt;&gt;Server: Cache Response
    Server--&gt;&gt;Client: HTTP Response
    Client-&gt;&gt;Client: Parse &amp; Process
</code></pre>

<h3 id="http-methods--status-codes">HTTP Methods &amp; Status Codes</h3>

<pre><code class="language-mermaid">graph TB
    subgraph "HTTP Methods"
        A[GET] --&gt; B[Safe, Idempotent]
        C[POST] --&gt; D[Not Safe, Not Idempotent]
        E[PUT] --&gt; F[Not Safe, Idempotent]
        G[DELETE] --&gt; H[Not Safe, Idempotent]
        I[PATCH] --&gt; J[Not Safe, Not Idempotent]
    end

    subgraph "Status Code Ranges"
        K[1xx Informational] --&gt; L[100 Continue]
        M[2xx Success] --&gt; N[200 OK, 201 Created]
        O[3xx Redirection] --&gt; P[301 Moved, 304 Not Modified]
        Q[4xx Client Error] --&gt; R[400 Bad Request, 404 Not Found]
        S[5xx Server Error] --&gt; T[500 Internal Server Error]
    end
</code></pre>

<h3 id="http-headers-deep-dive">HTTP Headers Deep Dive</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
</pre></td><td class="rouge-code"><pre><span class="c1">// Common HTTP Headers</span>
<span class="kd">const</span> <span class="nx">httpHeaders</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// Request Headers</span>
  <span class="na">request</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">Accept</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Accept-Language</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">en-US,en;q=0.5</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Accept-Encoding</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gzip, deflate, br</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">User-Agent</span><span class="dl">"</span><span class="p">:</span>
      <span class="dl">"</span><span class="s2">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">no-cache</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">If-None-Match</span><span class="dl">"</span><span class="p">:</span> <span class="dl">'</span><span class="s1">"abc123"</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">If-Modified-Since</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Wed, 21 Oct 2015 07:28:00 GMT</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>

  <span class="c1">// Response Headers</span>
  <span class="na">response</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json; charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Content-Length</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1234</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">public, max-age=3600</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">ETag</span><span class="p">:</span> <span class="dl">'</span><span class="s1">"abc123"</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Last-Modified</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Wed, 21 Oct 2015 07:28:00 GMT</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Set-Cookie</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sessionId=abc123; HttpOnly; Secure; SameSite=Strict</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Access-Control-Allow-Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Frame-Options</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">DENY</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">X-Content-Type-Options</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">nosniff</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">Strict-Transport-Security</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">max-age=31536000; includeSubDomains</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// HTTP Client Implementation</span>
<span class="kd">class</span> <span class="nx">HTTPClient</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">baseURL</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span> <span class="o">=</span> <span class="nx">baseURL</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaders</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">||</span> <span class="mi">5000</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">retries</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">retries</span> <span class="o">||</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">request</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">options</span><span class="p">.</span><span class="nx">headers</span> <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">method</span><span class="p">,</span>
      <span class="nx">headers</span><span class="p">,</span>
      <span class="na">timeout</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">method</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">lastError</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">attempt</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">retries</span><span class="p">;</span> <span class="nx">attempt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AbortController</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">timeoutId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">timeout</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">config</span><span class="p">,</span>
          <span class="na">signal</span><span class="p">:</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeoutId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nx">HTTPError</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lastError</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">AbortError</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`Request timeout on attempt </span><span class="p">${</span><span class="nx">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">HTTPError</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
            <span class="s2">`Server error on attempt </span><span class="p">${</span><span class="nx">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span>
          <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span> <span class="c1">// Don't retry client errors</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">attempt</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// Exponential backoff</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">throw</span> <span class="nx">lastError</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">parseResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">contentType</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span> <span class="o">&amp;&amp;</span> <span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">contentType</span> <span class="o">&amp;&amp;</span> <span class="nx">contentType</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">text/</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">blob</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">delay</span><span class="p">(</span><span class="nx">ms</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Convenience methods</span>
  <span class="k">async</span> <span class="kd">get</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">post</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">put</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">PUT</span><span class="dl">"</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">DELETE</span><span class="dl">"</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">patch</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">PATCH</span><span class="dl">"</span><span class="p">,</span> <span class="nx">endpoint</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">HTTPError</span> <span class="kd">extends</span> <span class="nb">Error</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">status</span><span class="p">,</span> <span class="nx">statusText</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="s2">`HTTP </span><span class="p">${</span><span class="nx">status</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">statusText</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">status</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">=</span> <span class="nx">statusText</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">HTTPError</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HTTPClient</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://api.example.com</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">timeout</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
  <span class="na">retries</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bearer token</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// Example usage</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">john@example.com</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">updatedUser</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users/1</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">John Updated</span><span class="dl">"</span> <span class="p">});</span>
  <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users/1</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP request failed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-websocket-protocol">üîå WebSocket Protocol</h2>

<h3 id="websocket-handshake--communication">WebSocket Handshake &amp; Communication</h3>

<pre><code class="language-mermaid">sequenceDiagram
    participant Client
    participant Server

    Client-&gt;&gt;Server: HTTP Upgrade Request
    Note over Client,Server: GET /chat HTTP/1.1&lt;br/&gt;Upgrade: websocket&lt;br/&gt;Connection: Upgrade&lt;br/&gt;Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==

    Server--&gt;&gt;Client: HTTP 101 Switching Protocols
    Note over Client,Server: HTTP/1.1 101 Switching Protocols&lt;br/&gt;Upgrade: websocket&lt;br/&gt;Connection: Upgrade&lt;br/&gt;Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=

    Note over Client,Server: WebSocket Connection Established

    Client-&gt;&gt;Server: Text Frame: "Hello Server"
    Server--&gt;&gt;Client: Text Frame: "Hello Client"
    Client-&gt;&gt;Server: Binary Frame: [binary data]
    Server--&gt;&gt;Client: Ping Frame
    Client--&gt;&gt;Server: Pong Frame
</code></pre>

<h3 id="websocket-implementation">WebSocket Implementation</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">WebSocketClient</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">reconnectAttempts</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="na">reconnectInterval</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
      <span class="na">heartbeatInterval</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">socket</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">connect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleOpen</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleMessage</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClose</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleError</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">WebSocket connection failed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scheduleReconnect</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleOpen</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">WebSocket connected</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startHeartbeat</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">flushMessageQueue</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">open</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleMessage</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

      <span class="c1">// Handle specific message types</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">pong</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">handlePong</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to parse WebSocket message:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleClose</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">WebSocket disconnected:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stopHeartbeat</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span>
      <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">wasClean</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">reconnectAttempts</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scheduleReconnect</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">WebSocket error:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">socket</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">flushMessageQueue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">startHeartbeat</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ping</span><span class="dl">"</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">heartbeatInterval</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">stopHeartbeat</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">heartbeatTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handlePong</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Reset heartbeat on pong received</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stopHeartbeat</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startHeartbeat</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">scheduleReconnect</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span><span class="o">++</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">delay</span> <span class="o">=</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">reconnectInterval</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
      <span class="s2">`Scheduling reconnect attempt </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">reconnectCount</span><span class="p">}</span><span class="s2"> in </span><span class="p">${</span><span class="nx">delay</span><span class="p">}</span><span class="s2">ms`</span>
    <span class="p">);</span>

    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="p">},</span> <span class="nx">delay</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Event handling</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">[]);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">off</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">listeners</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventListeners</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Client initiated close</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Real-time Chat Implementation</span>
<span class="kd">class</span> <span class="nx">ChatClient</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">serverUrl</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">userId</span> <span class="o">=</span> <span class="nx">userId</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketClient</span><span class="p">(</span><span class="nx">serverUrl</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">setupEventHandlers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">setupEventHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">open</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">join</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">userId</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handleMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Chat disconnected</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">handleMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="na">id</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="na">userId</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span>
          <span class="na">message</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">,</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="dl">"</span><span class="s2">userJoined</span><span class="dl">"</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">userJoined</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="dl">"</span><span class="s2">userLeft</span><span class="dl">"</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">userLeft</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="dl">"</span><span class="s2">userList</span><span class="dl">"</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onlineUsers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">users</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">userList</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">users</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">sendMessage</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="p">...</span><span class="nx">data</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">sendChatMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="nx">message</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Event handling</span>
  <span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ws</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">chat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatClient</span><span class="p">(</span><span class="dl">"</span><span class="s2">wss://chat.example.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">user123</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">chat</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">userId</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">chat</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">userJoined</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">userId</span><span class="p">}</span><span class="s2"> joined the chat`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">chat</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">userLeft</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">userId</span><span class="p">}</span><span class="s2"> left the chat`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Send a message</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">sendChatMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello, everyone!</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-http2--http3">üöÄ HTTP/2 &amp; HTTP/3</h2>

<h3 id="http2-features">HTTP/2 Features</h3>

<pre><code class="language-mermaid">graph TB
    subgraph "HTTP/2 Features"
        A[Multiplexing] --&gt; B[Multiple requests over single connection]
        C[Server Push] --&gt; D[Proactive resource delivery]
        E[Header Compression] --&gt; F[HPACK compression]
        G[Binary Protocol] --&gt; H[More efficient parsing]
        I[Stream Prioritization] --&gt; J[Resource priority management]
    end

    subgraph "Performance Benefits"
        K[Reduced Latency] --&gt; L[Faster page loads]
        M[Better Bandwidth] --&gt; N[Improved throughput]
        O[Connection Reuse] --&gt; P[Fewer TCP connections]
    end
</code></pre>

<h3 id="http2-implementation">HTTP/2 Implementation</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
</pre></td><td class="rouge-code"><pre><span class="c1">// HTTP/2 Client with Server Push</span>
<span class="kd">class</span> <span class="nx">HTTP2Client</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pushHandlers</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Note: This is a simplified example</span>
      <span class="c1">// Real HTTP/2 client would use a library like h2 or node:http2</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connection</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">createHTTP2Connection</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">push</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleServerPush</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleError</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP/2 connection established</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP/2 connection failed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">request</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Not connected</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">requestHeaders</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">:method</span><span class="dl">"</span><span class="p">:</span> <span class="nx">method</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">:path</span><span class="dl">"</span><span class="p">:</span> <span class="nx">path</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">:scheme</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">:authority</span><span class="dl">"</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">authority</span><span class="p">,</span>
      <span class="p">...</span><span class="nx">headers</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">requestHeaders</span><span class="p">);</span>

      <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span>
      <span class="p">});</span>

      <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span>
          <span class="na">status</span><span class="p">:</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">:status</span><span class="dl">"</span><span class="p">],</span>
          <span class="na">headers</span><span class="p">:</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span>
          <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
        <span class="p">});</span>
      <span class="p">});</span>

      <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="nx">reject</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">handleServerPush</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="dl">"</span><span class="s2">:path</span><span class="dl">"</span><span class="p">];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server push for: </span><span class="p">${</span><span class="nx">path</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">data</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Handle pushed resource</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">handlePushedResource</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">headers</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">handlePushedResource</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Cache the pushed resource</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">.css</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">injectCSS</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">.js</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">injectJS</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpg|jpeg|gif|svg|webp</span><span class="se">)</span><span class="sr">$/</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">preloadImage</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">injectCSS</span><span class="p">(</span><span class="nx">css</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">style</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">style</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">css</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">injectJS</span><span class="p">(</span><span class="nx">js</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">js</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">preloadImage</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">data</span><span class="p">]);</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>

    <span class="c1">// Preload the image</span>
    <span class="kd">const</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

    <span class="c1">// Store for later use</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pushHandlers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP/2 connection error:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// HTTP/3 with QUIC</span>
<span class="kd">class</span> <span class="nx">HTTP3Client</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// HTTP/3 is still experimental</span>
    <span class="c1">// This is a conceptual implementation</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP/3 client - experimental feature</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// HTTP/3 uses QUIC protocol over UDP</span>
    <span class="c1">// Provides better performance over unreliable networks</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connecting via HTTP/3/QUIC...</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">request</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="c1">// HTTP/3 benefits:</span>
    <span class="c1">// - 0-RTT connection resumption</span>
    <span class="c1">// - Better multiplexing</span>
    <span class="c1">// - Improved congestion control</span>
    <span class="c1">// - Connection migration</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">HTTP/3 request:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-caching-strategies">üíæ Caching Strategies</h2>

<h3 id="cache-hierarchy">Cache Hierarchy</h3>

<pre><code class="language-mermaid">graph TB
    subgraph "Cache Layers"
        A[Browser Cache] --&gt; B[Memory Cache]
        A --&gt; C[Disk Cache]
        D[CDN Cache] --&gt; E[Edge Servers]
        F[Application Cache] --&gt; G[Service Workers]
        H[Database Cache] --&gt; I[Redis/Memcached]
    end

    subgraph "Cache Strategies"
        J[Cache-First] --&gt; K[Return cached, fallback to network]
        L[Network-First] --&gt; M[Return network, fallback to cache]
        N[Stale-While-Revalidate] --&gt; O[Return stale, update in background]
        P[Cache-Only] --&gt; Q[Return cached only]
    end
</code></pre>

<h3 id="advanced-caching-implementation">Advanced Caching Implementation</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">CacheManager</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">memoryCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">serviceWorker</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">"</span><span class="s2">serviceWorker</span><span class="dl">"</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">serviceWorker</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="dl">"</span><span class="s2">/sw.js</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service Worker registered</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service Worker registration failed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Memory Cache</span>
  <span class="nx">setMemoryCache</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="mi">300000</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 5 minutes default</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">memoryCache</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">value</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
      <span class="nx">ttl</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">getMemoryCache</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">memoryCache</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">memoryCache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// HTTP Cache Headers</span>
  <span class="nx">setCacheHeaders</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="nx">strategy</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">public</span><span class="dl">"</span><span class="p">,</span> <span class="nx">maxAge</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">strategy</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">public</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`public, max-age=</span><span class="p">${</span><span class="nx">maxAge</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">private</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`private, max-age=</span><span class="p">${</span><span class="nx">maxAge</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">no-cache</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">no-cache, must-revalidate</span><span class="dl">"</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">no-store</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">no-store, no-cache, must-revalidate</span><span class="dl">"</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">stale-while-revalidate</span><span class="dl">"</span><span class="p">:</span>
        <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">Cache-Control</span><span class="dl">"</span><span class="p">,</span>
          <span class="s2">`public, max-age=</span><span class="p">${</span><span class="nx">maxAge</span><span class="p">}</span><span class="s2">, stale-while-revalidate=</span><span class="p">${</span><span class="nx">maxAge</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
      <span class="na">statusText</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">,</span>
      <span class="nx">headers</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Cache Strategies</span>
  <span class="k">async</span> <span class="nx">cacheFirst</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">networkResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Network request failed and no cache available</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">networkFirst</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">networkResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">staleWhileRevalidate</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>

    <span class="c1">// Return cached response immediately if available</span>
    <span class="kd">const</span> <span class="nx">fetchPromise</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">fetchPromise</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Cache Invalidation</span>
  <span class="k">async</span> <span class="nx">invalidateCache</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">matchingKeys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">matchingKeys</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">cache</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)));</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Invalidated </span><span class="p">${</span><span class="nx">matchingKeys</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cache entries`</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Cache Analytics</span>
  <span class="k">async</span> <span class="nx">getCacheStats</span><span class="p">(</span><span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span>

    <span class="kd">let</span> <span class="nx">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">entries</span><span class="p">:</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">totalSize</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">averageSize</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">oldestEntry</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="na">newestEntry</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">blob</span><span class="p">();</span>
        <span class="nx">totalSize</span> <span class="o">+=</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>

        <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stats</span><span class="p">.</span><span class="nx">oldestEntry</span> <span class="o">||</span> <span class="nx">date</span> <span class="o">&lt;</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">oldestEntry</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stats</span><span class="p">.</span><span class="nx">oldestEntry</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stats</span><span class="p">.</span><span class="nx">newestEntry</span> <span class="o">||</span> <span class="nx">date</span> <span class="o">&gt;</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">newestEntry</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stats</span><span class="p">.</span><span class="nx">newestEntry</span> <span class="o">=</span> <span class="nx">date</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">stats</span><span class="p">.</span><span class="nx">totalSize</span> <span class="o">=</span> <span class="nx">totalSize</span><span class="p">;</span>
    <span class="nx">stats</span><span class="p">.</span><span class="nx">averageSize</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">totalSize</span> <span class="o">/</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">stats</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Service Worker Implementation</span>
<span class="kd">class</span> <span class="nx">ServiceWorkerCache</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cacheName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">app-cache-v1</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">assets</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">/index.html</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">/styles/main.css</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">/scripts/app.js</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">/images/logo.png</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">install</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service Worker installing...</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
      <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheName</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">cache</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Caching app shell</span><span class="dl">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">addAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">assets</span><span class="p">);</span>
      <span class="p">})</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">strategy</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">strategy</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheName</span><span class="p">);</span>

    <span class="c1">// Check cache first</span>
    <span class="kd">const</span> <span class="nx">cachedResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">cachedResponse</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Fallback to network</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">networkResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>

      <span class="c1">// Cache successful responses</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">networkResponse</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">networkResponse</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">networkResponse</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Return offline page if available</span>
      <span class="kd">const</span> <span class="nx">offlineResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="dl">"</span><span class="s2">/offline.html</span><span class="dl">"</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">offlineResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">offlineResponse</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">activate</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Service Worker activating...</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
      <span class="nx">caches</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">cacheNames</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
          <span class="nx">cacheNames</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">cacheName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cacheName</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">cacheName</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Deleting old cache:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">cacheName</span><span class="p">);</span>
              <span class="k">return</span> <span class="nx">caches</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">})</span>
        <span class="p">);</span>
      <span class="p">})</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">cacheManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CacheManager</span><span class="p">();</span>

<span class="c1">// Cache API responses</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchWithCache</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">cacheKey</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">options</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>

  <span class="c1">// Check memory cache first</span>
  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">cacheManager</span><span class="p">.</span><span class="nx">getMemoryCache</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Fetch from network</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

  <span class="c1">// Cache the result</span>
  <span class="nx">cacheManager</span><span class="p">.</span><span class="nx">setMemoryCache</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="mi">300000</span><span class="p">);</span> <span class="c1">// 5 minutes</span>

  <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Example usage</span>
<span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetchWithCache</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-security-protocols">üîí Security Protocols</h2>

<h3 id="tlsssl-handshake">TLS/SSL Handshake</h3>

<pre><code class="language-mermaid">sequenceDiagram
    participant Client
    participant Server

    Client-&gt;&gt;Server: Client Hello
    Note over Client,Server: Supported cipher suites, random number

    Server--&gt;&gt;Client: Server Hello
    Note over Client,Server: Chosen cipher suite, random number, certificate

    Client-&gt;&gt;Server: Client Key Exchange
    Note over Client,Server: Pre-master secret

    Note over Client,Server: Both compute master secret

    Client-&gt;&gt;Server: Finished
    Server--&gt;&gt;Client: Finished

    Note over Client,Server: Encrypted communication begins
</code></pre>

<h3 id="security-implementation">Security Implementation</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">SecurityManager</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">csp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createCSP</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hsts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createHSTS</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createCORS</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">createCSP</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">default-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">script-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">'unsafe-inline'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https://cdn.example.com</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">style-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">'unsafe-inline'</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">https://fonts.googleapis.com</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="dl">"</span><span class="s2">img-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">data:</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https:</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">font-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https://fonts.gstatic.com</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">connect-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https://api.example.com</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">frame-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'none'</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">object-src</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'none'</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">base-uri</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">form-action</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">'self'</span><span class="dl">"</span><span class="p">],</span>
      <span class="dl">"</span><span class="s2">upgrade-insecure-requests</span><span class="dl">"</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">createHSTS</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">max-age</span><span class="dl">"</span><span class="p">:</span> <span class="mi">31536000</span><span class="p">,</span> <span class="c1">// 1 year</span>
      <span class="na">includeSubDomains</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">preload</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">createCORS</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">Access-Control-Allow-Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://app.example.com</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Access-Control-Allow-Methods</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET, POST, PUT, DELETE, OPTIONS</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Access-Control-Allow-Headers</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Content-Type, Authorization</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Access-Control-Allow-Credentials</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">Access-Control-Max-Age</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">86400</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// XSS Prevention</span>
  <span class="nx">sanitizeInput</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">input</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// CSRF Protection</span>
  <span class="nx">generateCSRFToken</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">crypto</span>
      <span class="p">.</span><span class="nx">getRandomValues</span><span class="p">(</span><span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">acc</span> <span class="o">+</span> <span class="nx">val</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0</span><span class="dl">"</span><span class="p">),</span> <span class="dl">""</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">validateCSRFToken</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">storedToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">token</span> <span class="o">===</span> <span class="nx">storedToken</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Content Security Policy</span>
  <span class="nx">setCSPHeaders</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cspString</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">csp</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">map</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">values</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">values</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">key</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">values</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">; </span><span class="dl">"</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Security-Policy</span><span class="dl">"</span><span class="p">,</span> <span class="nx">cspString</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
      <span class="na">statusText</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">,</span>
      <span class="nx">headers</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// HTTPS Enforcement</span>
  <span class="nx">enforceHTTPS</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">https:</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">localhost</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span>
        <span class="s2">`https://</span><span class="p">${</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="p">}${</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">}${</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span><span class="s2">`</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Secure Headers</span>
  <span class="nx">setSecureHeaders</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>

    <span class="c1">// HSTS</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Strict-Transport-Security</span><span class="dl">"</span><span class="p">,</span>
      <span class="s2">`max-age=</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">hsts</span><span class="p">[</span><span class="dl">"</span><span class="s2">max-age</span><span class="dl">"</span><span class="p">]}</span><span class="s2">; includeSubDomains; preload`</span>
    <span class="p">);</span>

    <span class="c1">// X-Frame-Options</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">X-Frame-Options</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DENY</span><span class="dl">"</span><span class="p">);</span>

    <span class="c1">// X-Content-Type-Options</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">X-Content-Type-Options</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">nosniff</span><span class="dl">"</span><span class="p">);</span>

    <span class="c1">// Referrer Policy</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Referrer-Policy</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">strict-origin-when-cross-origin</span><span class="dl">"</span><span class="p">);</span>

    <span class="c1">// Permissions Policy</span>
    <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Permissions-Policy</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">geolocation=(), microphone=(), camera=()</span><span class="dl">"</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
      <span class="na">statusText</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">,</span>
      <span class="nx">headers</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">security</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SecurityManager</span><span class="p">();</span>

<span class="c1">// Enforce HTTPS</span>
<span class="nx">security</span><span class="p">.</span><span class="nx">enforceHTTPS</span><span class="p">();</span>

<span class="c1">// Sanitize user input</span>
<span class="kd">const</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;script&gt;alert("xss")&lt;/script&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sanitized</span> <span class="o">=</span> <span class="nx">security</span><span class="p">.</span><span class="nx">sanitizeInput</span><span class="p">(</span><span class="nx">userInput</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sanitized</span><span class="p">);</span> <span class="c1">// &amp;lt;script&amp;gt;alert("xss")&amp;lt;/script&amp;gt;</span>

<span class="c1">// Generate CSRF token</span>
<span class="kd">const</span> <span class="nx">csrfToken</span> <span class="o">=</span> <span class="nx">security</span><span class="p">.</span><span class="nx">generateCSRFToken</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-performance-optimization">‚ö° Performance Optimization</h2>

<h3 id="network-performance-monitoring">Network Performance Monitoring</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">NetworkMonitor</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">requests</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">errors</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">performance</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Monitor network requests</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">interceptFetch</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">interceptXMLHttpRequest</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">monitorResourceTiming</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">interceptFetch</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">originalFetch</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span><span class="p">;</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">fetch</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">originalFetch</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">recordRequest</span><span class="p">({</span>
          <span class="nx">url</span><span class="p">,</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">duration</span><span class="p">:</span> <span class="nx">endTime</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">,</span>
          <span class="na">status</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
          <span class="na">size</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">content-length</span><span class="dl">"</span><span class="p">),</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">recordError</span><span class="p">({</span>
          <span class="nx">url</span><span class="p">,</span>
          <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">duration</span><span class="p">:</span> <span class="nx">endTime</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">,</span>
          <span class="na">error</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
        <span class="p">});</span>

        <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">interceptXMLHttpRequest</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">originalOpen</span> <span class="o">=</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">originalSend</span> <span class="o">=</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span><span class="p">;</span>

    <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_method</span> <span class="o">=</span> <span class="nx">method</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

      <span class="k">return</span> <span class="nx">originalOpen</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">recordRequest</span><span class="p">({</span>
          <span class="na">url</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">,</span>
          <span class="na">method</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="p">,</span>
          <span class="na">duration</span><span class="p">:</span> <span class="nx">endTime</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">,</span>
          <span class="na">status</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
          <span class="na">size</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">content-length</span><span class="dl">"</span><span class="p">),</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
        <span class="p">});</span>
      <span class="p">});</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">recordError</span><span class="p">({</span>
          <span class="na">url</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_url</span><span class="p">,</span>
          <span class="na">method</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_method</span><span class="p">,</span>
          <span class="na">duration</span><span class="p">:</span> <span class="nx">endTime</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_startTime</span><span class="p">,</span>
          <span class="na">error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Network error</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
        <span class="p">});</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="nx">originalSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">monitorResourceTiming</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">"</span><span class="s2">PerformanceObserver</span><span class="dl">"</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">list</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">();</span>
        <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">entryType</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">resource</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">recordResourceTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">});</span>

      <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">resource</span><span class="dl">"</span><span class="p">]</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">recordRequest</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">requests</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">analyzePerformance</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">recordError</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">recordResourceTiming</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">performance</span><span class="p">[</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">duration</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span>
      <span class="na">transferSize</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">transferSize</span><span class="p">,</span>
      <span class="na">decodedBodySize</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">decodedBodySize</span><span class="p">,</span>
      <span class="na">initiatorType</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">initiatorType</span><span class="p">,</span>
      <span class="na">startTime</span><span class="p">:</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">analyzePerformance</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">requests</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">requests</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">durations</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">duration</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">avgDuration</span> <span class="o">=</span> <span class="nx">durations</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">durations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">maxDuration</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">durations</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">minDuration</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(...</span><span class="nx">durations</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">slowRequests</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">analysis</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">totalRequests</span><span class="p">:</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">averageDuration</span><span class="p">:</span> <span class="nx">avgDuration</span><span class="p">,</span>
      <span class="nx">maxDuration</span><span class="p">,</span>
      <span class="nx">minDuration</span><span class="p">,</span>
      <span class="na">slowRequests</span><span class="p">:</span> <span class="nx">slowRequests</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">errorRate</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Network Performance Analysis:</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">analysis</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">getReport</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">,</span>
      <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Performance recommendations</span>
  <span class="nx">getRecommendations</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">analysis</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">analysis</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">averageDuration</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">Consider implementing caching strategies</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">slowRequests</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">Optimize slow requests or implement lazy loading</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">errorRate</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">recommendations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">Investigate and fix network errors</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">recommendations</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">const</span> <span class="nx">networkMonitor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NetworkMonitor</span><span class="p">();</span>

<span class="c1">// Get performance report</span>
<span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">report</span> <span class="o">=</span> <span class="nx">networkMonitor</span><span class="p">.</span><span class="nx">getReport</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">recommendations</span> <span class="o">=</span> <span class="nx">networkMonitor</span><span class="p">.</span><span class="nx">getRecommendations</span><span class="p">();</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Network Report:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">report</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Recommendations:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">recommendations</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">30000</span><span class="p">);</span> <span class="c1">// Every 30 seconds</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<h2 id="-summary">üéØ Summary</h2>

<p>Understanding network protocols helps you:</p>

<ol>
  <li><strong>Optimize performance</strong> by leveraging protocol features</li>
  <li><strong>Implement security</strong> best practices</li>
  <li><strong>Debug network issues</strong> more effectively</li>
  <li><strong>Choose appropriate protocols</strong> for different use cases</li>
  <li><strong>Monitor and improve</strong> network performance</li>
</ol>

<h3 id="key-takeaways">Key Takeaways</h3>

<ul>
  <li><strong>HTTP/2</strong> provides multiplexing and server push</li>
  <li><strong>WebSockets</strong> enable real-time bidirectional communication</li>
  <li><strong>Caching strategies</strong> significantly improve performance</li>
  <li><strong>Security protocols</strong> protect data in transit</li>
  <li><strong>Performance monitoring</strong> helps identify bottlenecks</li>
</ul>

<h3 id="next-steps">Next Steps</h3>

<ol>
  <li><strong>Implement caching</strong> strategies in your applications</li>
  <li><strong>Monitor network performance</strong> in production</li>
  <li><strong>Use appropriate protocols</strong> for different use cases</li>
  <li><strong>Stay updated</strong> with protocol improvements</li>
  <li><strong>Test with different network conditions</strong></li>
</ol>

        </div>
    </article>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Study Resources</h3>
                    <p>Comprehensive collection of frontend interview questions, coding challenges, and system design problems.</p>
                </div>
                <div class="footer-section">
                    <h3>Progress Tracking</h3>
                    <p>Monitor your learning journey with detailed progress indicators and completion status.</p>
                </div>
                <div class="footer-section">
                    <h3>Big Tech Ready</h3>
                    <p>Curated content specifically designed for interviews at Google, Meta, Amazon, Apple, and Netflix.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Frontend Interview Hub. Built for aspiring frontend engineers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/assets/js/app.js"></script>
</body>
</html>