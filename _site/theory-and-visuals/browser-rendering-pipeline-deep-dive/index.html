<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Architecture and Rendering Pipeline Deep Dive | Frontend Interview Preparation Guide</title>
    <meta name="description" content="Comprehensive guide to browser internals, rendering pipeline, performance optimization, and debugging techniques for frontend interviews">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="container">
            <div class="logo">Frontend Interview Hub</div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="#progress">Progress</a></li>
                <li><a href="#knowledge">Knowledge</a></li>
                <li><a href="https://github.com/nee/interview">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="content-container">
    
        <nav class="breadcrumb">
            <ol>
                <li><a href="/">Home</a></li>
                
                
                
                    
                
                    
                        
                        
                            <li><a href="/theory-and-visuals/">Theory and visuals</a></li>
                        
                    
                
                    
                        
                        
                            <li class="active">Browser architecture and rendering pipeline deep dive</li>
                        
                    
                
            </ol>
        </nav>
    
    
    <article class="content">
        
            <header class="content-header">
                <h1 class="content-title">Browser Architecture and Rendering Pipeline Deep Dive</h1>
                
                    <p class="content-description">Comprehensive guide to browser internals, rendering pipeline, performance optimization, and debugging techniques for frontend interviews</p>
                
                
            </header>
        
        
        <div class="content-body">
            <h1 id="browser-architecture-and-rendering-pipeline-deep-dive">Browser Architecture and Rendering Pipeline Deep Dive</h1>

<h2 id="-overview">üéØ Overview</h2>

<p>Understanding browser internals is crucial for frontend interviews at big tech companies. This guide provides deep insights into how browsers work, enabling you to answer performance, debugging, and optimization questions with confidence.</p>

<h2 id="Ô∏è-browser-architecture-overview">üèóÔ∏è Browser Architecture Overview</h2>

<h3 id="multi-process-architecture">Multi-Process Architecture</h3>

<p>Modern browsers use a multi-process architecture for security, stability, and performance:</p>

<pre><code class="language-mermaid">graph TB
    subgraph "Browser Process"
        A[UI Thread] --&gt; B[Network Thread]
        B --&gt; C[Storage Thread]
        C --&gt; D[Device Thread]
    end
    
    subgraph "Renderer Process"
        E[Main Thread] --&gt; F[Compositor Thread]
        F --&gt; G[Web Workers]
    end
    
    subgraph "GPU Process"
        H[Graphics Operations]
        I[Hardware Acceleration]
    end
    
    subgraph "Plugin Process"
        J[Flash/Extensions]
    end
    
    A -.-&gt; E
    F -.-&gt; H
</code></pre>

<h3 id="process-responsibilities">Process Responsibilities</h3>

<h4 id="1-browser-process">1. Browser Process</h4>
<ul>
  <li><strong>UI Thread</strong>: Handles browser UI, tabs, address bar</li>
  <li><strong>Network Thread</strong>: Manages HTTP requests, downloads</li>
  <li><strong>Storage Thread</strong>: File system access, databases</li>
  <li><strong>Device Thread</strong>: Camera, microphone access</li>
</ul>

<h4 id="2-renderer-process-site-isolation">2. Renderer Process (Site Isolation)</h4>
<ul>
  <li><strong>Main Thread</strong>: JavaScript execution, DOM manipulation, layout</li>
  <li><strong>Compositor Thread</strong>: Handles scrolling, animations</li>
  <li><strong>Web Workers</strong>: Background JavaScript execution</li>
</ul>

<h4 id="3-gpu-process">3. GPU Process</h4>
<ul>
  <li>Hardware-accelerated graphics</li>
  <li>Video decoding</li>
  <li>Canvas and WebGL operations</li>
</ul>

<h2 id="-critical-rendering-path">üîÑ Critical Rendering Path</h2>

<h3 id="1-navigation-and-resource-loading">1. Navigation and Resource Loading</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre><span class="c1">// Performance timing visualization</span>
<span class="kd">class</span> <span class="nx">NavigationTiming</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">measureNavigation</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">navigation</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">navigation</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="kd">const</span> <span class="nx">timing</span> <span class="o">=</span> <span class="p">{</span>
      <span class="c1">// DNS resolution</span>
      <span class="na">dnsTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">domainLookupEnd</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">domainLookupStart</span><span class="p">,</span>
      
      <span class="c1">// TCP connection</span>
      <span class="na">tcpTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">connectStart</span><span class="p">,</span>
      
      <span class="c1">// SSL handshake</span>
      <span class="na">sslTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">secureConnectionStart</span> <span class="o">&gt;</span> <span class="mi">0</span> 
        <span class="p">?</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">secureConnectionStart</span> 
        <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        
      <span class="c1">// Request/Response</span>
      <span class="na">requestTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">responseStart</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">requestStart</span><span class="p">,</span>
      <span class="na">responseTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">responseEnd</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">responseStart</span><span class="p">,</span>
      
      <span class="c1">// DOM processing</span>
      <span class="na">domProcessing</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">domContentLoadedEventStart</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">responseEnd</span><span class="p">,</span>
      
      <span class="c1">// Resource loading</span>
      <span class="na">resourceLoadTime</span><span class="p">:</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">loadEventStart</span> <span class="o">-</span> <span class="nx">navigation</span><span class="p">.</span><span class="nx">domContentLoadedEventEnd</span>
    <span class="p">};</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">timing</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">timing</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">visualizeWaterfall</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">resources</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="nx">resources</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">resource</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">waterfall</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">).</span><span class="nx">pop</span><span class="p">(),</span>
        <span class="na">startTime</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">startTime</span><span class="p">),</span>
        <span class="na">duration</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">duration</span><span class="p">),</span>
        <span class="na">size</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">transferSize</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">cached</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">initiatorType</span>
      <span class="p">};</span>
      
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">waterfall</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">30</span><span class="p">)}</span><span class="s2"> | `</span> <span class="o">+</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">waterfall</span><span class="p">.</span><span class="nx">startTime</span><span class="p">}</span><span class="s2">ms`</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">waterfall</span><span class="p">.</span><span class="nx">duration</span><span class="p">}</span><span class="s2">ms`</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">waterfall</span><span class="p">.</span><span class="nx">size</span><span class="p">}</span><span class="s2">`</span><span class="p">.</span><span class="nx">padEnd</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">waterfall</span><span class="p">.</span><span class="nx">type</span><span class="p">}</span><span class="s2">`</span>
      <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="nx">NavigationTiming</span><span class="p">.</span><span class="nx">measureNavigation</span><span class="p">();</span>
<span class="nx">NavigationTiming</span><span class="p">.</span><span class="nx">visualizeWaterfall</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-html-parsing-and-dom-construction">2. HTML Parsing and DOM Construction</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
</pre></td><td class="rouge-code"><pre><span class="c1">// DOM construction simulation</span>
<span class="kd">class</span> <span class="nx">DOMParser</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tokens</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">domTree</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parseStartTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// Tokenization phase</span>
  <span class="nx">tokenize</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parseStartTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üîç Starting HTML tokenization...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Simplified tokenization</span>
    <span class="kd">const</span> <span class="nx">tokenRegex</span> <span class="o">=</span> <span class="sr">/&lt;</span><span class="se">\/?([</span><span class="sr">a-zA-Z</span><span class="se">][</span><span class="sr">a-zA-Z0-9</span><span class="se">]</span><span class="sr">*</span><span class="se">)\s</span><span class="sr">*</span><span class="se">([^</span><span class="sr">&gt;</span><span class="se">]</span><span class="sr">*</span><span class="se">)</span><span class="sr">&gt;/g</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">match</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">((</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">tokenRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">html</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">[</span><span class="nx">fullMatch</span><span class="p">,</span> <span class="nx">tagName</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">]</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">isClosing</span> <span class="o">=</span> <span class="nx">fullMatch</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;/</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">isClosing</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">endTag</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">startTag</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">tagName</span><span class="p">:</span> <span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>
        <span class="na">attributes</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseAttributes</span><span class="p">(</span><span class="nx">attributes</span><span class="p">),</span>
        <span class="na">position</span><span class="p">:</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üìù Tokenized </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> tokens`</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokens</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">parseAttributes</span><span class="p">(</span><span class="nx">attrString</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">const</span> <span class="nx">attrRegex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(\w</span><span class="sr">+</span><span class="se">)</span><span class="sr">=</span><span class="se">[</span><span class="sr">"'</span><span class="se">]([^</span><span class="sr">"'</span><span class="se">]</span><span class="sr">*</span><span class="se">)[</span><span class="sr">"'</span><span class="se">]</span><span class="sr">/g</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">match</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">((</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">attrRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">attrString</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">attributes</span><span class="p">[</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">attributes</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// Tree construction phase</span>
  <span class="nx">buildDOM</span><span class="p">(</span><span class="nx">tokens</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üå≥ Building DOM tree...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="p">{</span> <span class="na">tagName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">document</span><span class="dl">'</span><span class="p">,</span> <span class="na">children</span><span class="p">:</span> <span class="p">[]</span> <span class="p">};</span>
    <span class="kd">let</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
    
    <span class="nx">tokens</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">token</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">startTag</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">tagName</span><span class="p">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">tagName</span><span class="p">,</span>
          <span class="na">attributes</span><span class="p">:</span> <span class="nx">token</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span>
          <span class="na">children</span><span class="p">:</span> <span class="p">[],</span>
          <span class="na">parent</span><span class="p">:</span> <span class="nx">current</span>
        <span class="p">};</span>
        
        <span class="nx">current</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        
        <span class="c1">// Self-closing tags don't need to be pushed to stack</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isSelfClosing</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">tagName</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
          <span class="nx">current</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="c1">// Simulate parser blocking for synchronous scripts</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="k">async</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">defer</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚è∏Ô∏è  Parser blocked by synchronous script</span><span class="dl">'</span><span class="p">);</span>
          <span class="c1">// In real browser, parser would wait for script execution</span>
        <span class="p">}</span>
        
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">endTag</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">current</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">domTree</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">parseTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseStartTime</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`‚úÖ DOM construction completed in </span><span class="p">${</span><span class="nx">parseTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">root</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">isSelfClosing</span><span class="p">(</span><span class="nx">tagName</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">'</span><span class="s1">img</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">br</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hr</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">meta</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">link</span><span class="dl">'</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">tagName</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="c1">// DOM tree visualization</span>
  <span class="nx">visualizeDOM</span><span class="p">(</span><span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">domTree</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">indent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">  </span><span class="dl">'</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">depth</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">indent</span><span class="p">}${</span><span class="nx">node</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">visualizeDOM</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-css-parsing-and-cssom-construction">3. CSS Parsing and CSSOM Construction</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
</pre></td><td class="rouge-code"><pre><span class="c1">// CSSOM construction simulation</span>
<span class="kd">class</span> <span class="nx">CSSOMBuilder</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">parseCSS</span><span class="p">(</span><span class="nx">cssText</span><span class="p">,</span> <span class="nx">source</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">inline</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üé® Parsing CSS from </span><span class="p">${</span><span class="nx">source</span><span class="p">}</span><span class="s2">...`</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">rules</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">const</span> <span class="nx">ruleRegex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">([^</span><span class="sr">{</span><span class="se">]</span><span class="sr">+</span><span class="se">)\s</span><span class="sr">*</span><span class="se">\{([^</span><span class="sr">}</span><span class="se">]</span><span class="sr">+</span><span class="se">)\}</span><span class="sr">/g</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">match</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">((</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">ruleRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">cssText</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">[,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">declarations</span><span class="p">]</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      
      <span class="kd">const</span> <span class="nx">rule</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">selector</span><span class="p">:</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">trim</span><span class="p">(),</span>
        <span class="na">declarations</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseDeclarations</span><span class="p">(</span><span class="nx">declarations</span><span class="p">),</span>
        <span class="na">specificity</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateSpecificity</span><span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">trim</span><span class="p">()),</span>
        <span class="nx">source</span>
      <span class="p">};</span>
      
      <span class="nx">rules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">rule</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">rules</span> <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üìÑ Parsed </span><span class="p">${</span><span class="nx">rules</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> CSS rules`</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">rules</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">parseDeclarations</span><span class="p">(</span><span class="nx">declarationsText</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">declarations</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">const</span> <span class="nx">declRegex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">([^</span><span class="sr">:</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">:</span><span class="se">\s</span><span class="sr">*</span><span class="se">([^</span><span class="sr">;</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">/g</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">match</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">((</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">declRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">declarationsText</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">property</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
      <span class="nx">declarations</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">declarations</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">calculateSpecificity</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simplified specificity calculation</span>
    <span class="kd">const</span> <span class="nx">ids</span> <span class="o">=</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/#/g</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">/g</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">elements</span> <span class="o">=</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\b[</span><span class="sr">a-z</span><span class="se">]</span><span class="sr">+</span><span class="se">\b</span><span class="sr">/g</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">ids</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="nx">classes</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="nx">elements</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">buildCSSO–ú</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üèóÔ∏è  Building CSSOM...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Combine all stylesheets and sort by specificity</span>
    <span class="kd">const</span> <span class="nx">allRules</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">stylesheet</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">allRules</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">stylesheet</span><span class="p">.</span><span class="nx">rules</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="c1">// Sort by specificity (higher specificity first)</span>
    <span class="nx">allRules</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">specificity</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">specificity</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">rules</span><span class="p">:</span> <span class="nx">allRules</span><span class="p">,</span>
      <span class="na">computedStyles</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">()</span> <span class="c1">// Will store computed styles for elements</span>
    <span class="p">};</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`‚úÖ CSSOM built with </span><span class="p">${</span><span class="nx">allRules</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> rules`</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// Simulate style computation</span>
  <span class="nx">computeStyles</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">domTree</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">computedStyle</span> <span class="o">=</span> <span class="p">{};</span>
    
    <span class="c1">// Apply matching rules</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span><span class="p">.</span><span class="nx">rules</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">rule</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">matchesSelector</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">rule</span><span class="p">.</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">domTree</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">computedStyle</span><span class="p">,</span> <span class="nx">rule</span><span class="p">.</span><span class="nx">declarations</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="c1">// Apply inheritance</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">parent</span> <span class="o">&amp;&amp;</span> <span class="nx">element</span><span class="p">.</span><span class="nx">parent</span> <span class="o">!==</span> <span class="nx">domTree</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">parentStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span><span class="p">.</span><span class="nx">computedStyles</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="kd">const</span> <span class="nx">inheritableProperties</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">font-family</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">font-size</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">line-height</span><span class="dl">'</span><span class="p">];</span>
      
      <span class="nx">inheritableProperties</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">prop</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parentStyle</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">computedStyle</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">computedStyle</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parentStyle</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">cssom</span><span class="p">.</span><span class="nx">computedStyles</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">computedStyle</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">computedStyle</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">matchesSelector</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">domTree</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simplified selector matching</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">#</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">classes</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="kd">class</span> <span class="o">||</span> <span class="dl">''</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="nx">selector</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-layout-reflow-engine">4. Layout (Reflow) Engine</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
</pre></td><td class="rouge-code"><pre><span class="c1">// Layout engine simulation</span>
<span class="kd">class</span> <span class="nx">LayoutEngine</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">layoutTree</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">=</span> <span class="p">{</span> <span class="na">width</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="mi">768</span> <span class="p">};</span>
  <span class="p">}</span>
  
  <span class="nx">createLayoutTree</span><span class="p">(</span><span class="nx">domTree</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üìê Starting layout phase...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">layoutTree</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildLayoutTree</span><span class="p">(</span><span class="nx">domTree</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">layoutTree</span><span class="p">);</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚úÖ Layout phase completed</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">layoutTree</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">buildLayoutTree</span><span class="p">(</span><span class="nx">domNode</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">,</span> <span class="nx">parentLayoutNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Skip text nodes and elements with display: none</span>
    <span class="kd">const</span> <span class="nx">computedStyle</span> <span class="o">=</span> <span class="nx">cssom</span><span class="p">.</span><span class="nx">computedStyles</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">domNode</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">computedStyle</span><span class="p">.</span><span class="nx">display</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">const</span> <span class="nx">layoutNode</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">domNode</span><span class="p">,</span>
      <span class="nx">computedStyle</span><span class="p">,</span>
      <span class="na">children</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">parent</span><span class="p">:</span> <span class="nx">parentLayoutNode</span><span class="p">,</span>
      <span class="na">box</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">marginTop</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">marginRight</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">marginBottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">marginLeft</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">paddingTop</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">paddingRight</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">paddingBottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">paddingLeft</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="c1">// Process children</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">domNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">childLayoutNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildLayoutTree</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">,</span> <span class="nx">layoutNode</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">childLayoutNode</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">childLayoutNode</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">layoutNode</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">calculateLayout</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">layoutNode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="c1">// Calculate box model</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">calculateBoxModel</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">style</span><span class="p">);</span>
    
    <span class="c1">// Calculate position and size based on display type</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">block</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layoutBlock</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">inline</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layoutInline</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">flex</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layoutFlex</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">grid</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layoutGrid</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layoutBlock</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// Layout children</span>
    <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayout</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="nx">calculateBoxModel</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    
    <span class="c1">// Parse CSS values (simplified)</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">marginTop</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">marginTop</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">marginRight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">marginRight</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">marginBottom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">marginBottom</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">paddingTop</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">paddingRight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">paddingRight</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">paddingBottom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">paddingBottom</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">paddingLeft</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">parseValue</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simplified CSS value parsing</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">px</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">%</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">percentage</span><span class="dl">'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">layoutBlock</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="c1">// Block elements take full width by default</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginRight</span><span class="p">;</span>
    
    <span class="c1">// Calculate height based on content</span>
    <span class="kd">let</span> <span class="nx">contentHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">currentY</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">;</span>
    
    <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">currentY</span><span class="p">;</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayout</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingRight</span><span class="p">);</span>
      
      <span class="nx">currentY</span> <span class="o">+=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">marginTop</span> <span class="o">+</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">marginBottom</span><span class="p">;</span>
      <span class="nx">contentHeight</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">contentHeight</span><span class="p">,</span> <span class="nx">currentY</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">box</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">contentHeight</span> <span class="o">+</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingBottom</span><span class="p">;</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üì¶ Block layout: </span><span class="p">${</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">}</span><span class="s2">x</span><span class="p">${</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">layoutFlex</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginRight</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">flexDirection</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">flexDirection</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">row</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">justifyContent</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">justifyContent</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">flex-start</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">alignItems</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">alignItems</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">stretch</span><span class="dl">'</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">flexDirection</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">row</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">layoutFlexRow</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">justifyContent</span><span class="p">,</span> <span class="nx">alignItems</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">layoutFlexColumn</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">justifyContent</span><span class="p">,</span> <span class="nx">alignItems</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üîß Flex layout: </span><span class="p">${</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">}</span><span class="s2">x</span><span class="p">${</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">layoutFlexRow</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">justifyContent</span><span class="p">,</span> <span class="nx">alignItems</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">availableWidth</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span> <span class="o">-</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingRight</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
    
    <span class="c1">// Calculate flex basis and grow</span>
    <span class="kd">let</span> <span class="nx">totalFlexBasis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">totalFlexGrow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">flexBasis</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">.</span><span class="nx">flexBasis</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">flexGrow</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">.</span><span class="nx">flexGrow</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="nx">child</span><span class="p">.</span><span class="nx">flexBasis</span> <span class="o">=</span> <span class="nx">flexBasis</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="nx">flexBasis</span><span class="p">;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">flexGrow</span> <span class="o">=</span> <span class="nx">flexGrow</span><span class="p">;</span>
      
      <span class="nx">totalFlexBasis</span> <span class="o">+=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">flexBasis</span><span class="p">;</span>
      <span class="nx">totalFlexGrow</span> <span class="o">+=</span> <span class="nx">flexGrow</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="c1">// Distribute remaining space</span>
    <span class="kd">const</span> <span class="nx">remainingSpace</span> <span class="o">=</span> <span class="nx">availableWidth</span> <span class="o">-</span> <span class="nx">totalFlexBasis</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">spacePerGrow</span> <span class="o">=</span> <span class="nx">totalFlexGrow</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">remainingSpace</span> <span class="o">/</span> <span class="nx">totalFlexGrow</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="kd">let</span> <span class="nx">currentX</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">maxHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">currentX</span><span class="p">;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">;</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">flexBasis</span> <span class="o">+</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">flexGrow</span> <span class="o">*</span> <span class="nx">spacePerGrow</span><span class="p">);</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayout</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
      
      <span class="nx">currentX</span> <span class="o">+=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
      <span class="nx">maxHeight</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">maxHeight</span><span class="p">,</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">maxHeight</span> <span class="o">+</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span> <span class="o">+</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">paddingBottom</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">layoutGrid</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">containerWidth</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simplified CSS Grid implementation</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginLeft</span> <span class="o">-</span> <span class="nx">box</span><span class="p">.</span><span class="nx">marginRight</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">gridTemplateColumns</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">gridTemplateColumns</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">1fr</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">gridTemplateRows</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">gridTemplateRows</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">gap</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">gap</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Parse grid template</span>
    <span class="kd">const</span> <span class="nx">columns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseGridTemplate</span><span class="p">(</span><span class="nx">gridTemplateColumns</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseGridTemplate</span><span class="p">(</span><span class="nx">gridTemplateRows</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// Will be calculated</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üìä Grid layout: </span><span class="p">${</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> columns, </span><span class="p">${</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> rows`</span><span class="p">);</span>
    
    <span class="c1">// Position grid items</span>
    <span class="kd">let</span> <span class="nx">currentRow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">currentCol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">maxRowHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">child</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentCol</span> <span class="o">&gt;=</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentCol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">currentRow</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">currentRow</span> <span class="o">&gt;=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">rows</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">size</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span> <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">currentCol</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">col</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">currentCol</span> <span class="o">*</span> <span class="nx">gap</span><span class="p">);</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">currentRow</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">currentRow</span> <span class="o">*</span> <span class="nx">gap</span><span class="p">);</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">columns</span><span class="p">[</span><span class="nx">currentCol</span><span class="p">].</span><span class="nx">size</span><span class="p">;</span>
      
      <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayout</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
      
      <span class="nx">maxRowHeight</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">maxRowHeight</span><span class="p">,</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
      
      <span class="nx">currentCol</span><span class="o">++</span><span class="p">;</span>
      
      <span class="c1">// Update row height for auto rows</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">rows</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">].</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rows</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">].</span><span class="nx">size</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">rows</span><span class="p">[</span><span class="nx">currentRow</span><span class="p">].</span><span class="nx">size</span><span class="p">,</span> <span class="nx">child</span><span class="p">.</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="kd">const</span> <span class="nx">totalHeight</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">sum</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">gap</span><span class="p">);</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">totalHeight</span> <span class="o">+</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span> <span class="o">+</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingBottom</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">parseGridTemplate</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">containerSize</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">tracks</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="nx">tracks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">track</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">fr</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">fraction</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">track</span><span class="p">);</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">size</span><span class="p">:</span> <span class="p">(</span><span class="nx">containerSize</span> <span class="o">/</span> <span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">*</span> <span class="nx">fraction</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">fr</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fraction</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">px</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">size</span><span class="p">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">track</span><span class="p">),</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">px</span><span class="dl">'</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">track</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">size</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span> <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">size</span><span class="p">:</span> <span class="nx">containerSize</span> <span class="o">/</span> <span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">default</span><span class="dl">'</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// Performance monitoring</span>
  <span class="nx">measureLayoutPerformance</span><span class="p">(</span><span class="nx">domTree</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚è±Ô∏è  Starting layout performance measurement...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Simulate forced layout</span>
    <span class="kd">const</span> <span class="nx">layoutTree</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createLayoutTree</span><span class="p">(</span><span class="nx">domTree</span><span class="p">,</span> <span class="nx">cssom</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">layoutTime</span> <span class="o">=</span> <span class="nx">endTime</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">layoutTime</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">layoutTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">,</span>
      <span class="na">nodesProcessed</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">countNodes</span><span class="p">(</span><span class="nx">layoutTree</span><span class="p">),</span>
      <span class="na">averageTimePerNode</span><span class="p">:</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">layoutTime</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">countNodes</span><span class="p">(</span><span class="nx">layoutTree</span><span class="p">)).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span><span class="s2">ms`</span>
    <span class="p">};</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">stats</span><span class="p">);</span>
    
    <span class="c1">// Detect layout thrashing</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">layoutTime</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// More than one frame</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`‚ö†Ô∏è  Layout took </span><span class="p">${</span><span class="nx">layoutTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms, may cause jank!`</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">stats</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">countNodes</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">count</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">countNodes</span><span class="p">(</span><span class="nx">child</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-paint-and-composite">5. Paint and Composite</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
</pre></td><td class="rouge-code"><pre><span class="c1">// Paint and composite simulation</span>
<span class="kd">class</span> <span class="nx">PaintCompositeEngine</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">paintTree</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compositeTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">createPaintTree</span><span class="p">(</span><span class="nx">layoutTree</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üé® Starting paint phase...</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">paintTree</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildPaintTree</span><span class="p">(</span><span class="nx">layoutTree</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createCompositingLayers</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paintTree</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`‚úÖ Paint phase completed in </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">paintTree</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">buildPaintTree</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">,</span> <span class="nx">parentPaintNode</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">layoutNode</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">paintNode</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">layoutNode</span><span class="p">,</span>
      <span class="na">paintProperties</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">extractPaintProperties</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">),</span>
      <span class="na">children</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">parent</span><span class="p">:</span> <span class="nx">parentPaintNode</span><span class="p">,</span>
      <span class="na">needsNewLayer</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">shouldCreateNewLayer</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">),</span>
      <span class="na">layerId</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">};</span>
    
    <span class="c1">// Process children</span>
    <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">childPaintNode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildPaintTree</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">paintNode</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">childPaintNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">paintNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">childPaintNode</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">paintNode</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">extractPaintProperties</span><span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">backgroundColor</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">transparent</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">color</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">black</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">border</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">width</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderWidth</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">),</span>
        <span class="na">color</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">black</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">style</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">borderStyle</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">solid</span><span class="dl">'</span>
      <span class="p">},</span>
      <span class="na">borderRadius</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseValue</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderRadius</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">boxShadow</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">boxShadow</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">opacity</span><span class="p">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">transform</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">filter</span><span class="p">:</span> <span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span>
    <span class="p">};</span>
  <span class="p">}</span>
  
  <span class="nx">shouldCreateNewLayer</span><span class="p">(</span><span class="nx">layoutNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="c1">// Conditions that create new compositing layers</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">fixed</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">sticky</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">transform</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">opacity</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">video</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">canvas</span><span class="dl">'</span>
    <span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">createCompositingLayers</span><span class="p">(</span><span class="nx">paintTree</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üîó Creating compositing layers...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">let</span> <span class="nx">layerId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">traversePaintTree</span><span class="p">(</span><span class="nx">paintTree</span><span class="p">,</span> <span class="p">(</span><span class="nx">paintNode</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">needsNewLayer</span> <span class="o">||</span> <span class="o">!</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">id</span><span class="p">:</span> <span class="nx">layerId</span><span class="o">++</span><span class="p">,</span>
          <span class="nx">paintNode</span><span class="p">,</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[],</span>
          <span class="na">bounds</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateLayerBounds</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">),</span>
          <span class="na">needsRepaint</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">isGPULayer</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">shouldUseGPU</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">)</span>
        <span class="p">};</span>
        
        <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layerId</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üìã Created layer </span><span class="p">${</span><span class="nx">layer</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2"> for </span><span class="p">${</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span><span class="p">}${</span><span class="nx">layer</span><span class="p">.</span><span class="nx">isGPULayer</span> <span class="p">?</span> <span class="dl">'</span><span class="s1"> (GPU)</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">''</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Inherit parent's layer</span>
        <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layerId</span> <span class="o">=</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">layerId</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`‚úÖ Created </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> compositing layers`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">shouldUseGPU</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="p">(</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">video</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">canvas</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">transform</span><span class="dl">'</span> <span class="o">||</span>
      <span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">opacity</span><span class="dl">'</span>
    <span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">calculateLayerBounds</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">x</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
      <span class="na">y</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
      <span class="na">width</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
      <span class="na">height</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span>
    <span class="p">};</span>
  <span class="p">}</span>
  
  <span class="nx">traversePaintTree</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">paintNode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
    <span class="nx">callback</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">);</span>
    <span class="nx">paintNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">traversePaintTree</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="c1">// Simulate painting process</span>
  <span class="nx">paintLayers</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üñåÔ∏è  Starting paint process...</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">layer</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">needsRepaint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">paintLayer</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
        <span class="nx">layer</span><span class="p">.</span><span class="nx">needsRepaint</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üé® Painted </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> layers in </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">paintLayer</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">paintOps</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="c1">// Collect paint operations for this layer</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collectPaintOperations</span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">paintNode</span><span class="p">,</span> <span class="nx">paintOps</span><span class="p">);</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üñºÔ∏è  Layer </span><span class="p">${</span><span class="nx">layer</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">paintOps</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> paint operations`</span><span class="p">);</span>
    
    <span class="c1">// Simulate paint operations</span>
    <span class="nx">paintOps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">op</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">executePaintOperation</span><span class="p">(</span><span class="nx">op</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">layer</span><span class="p">.</span><span class="nx">paintOperations</span> <span class="o">=</span> <span class="nx">paintOps</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">collectPaintOperations</span><span class="p">(</span><span class="nx">paintNode</span><span class="p">,</span> <span class="nx">operations</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">paintNode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">box</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">paintProperties</span><span class="p">;</span>
    
    <span class="c1">// Background</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">transparent</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">operations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">fillRect</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">x</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="na">y</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="na">width</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
        <span class="na">color</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">backgroundColor</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="c1">// Border</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">border</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">operations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">strokeRect</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">x</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
        <span class="na">y</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
        <span class="na">width</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
        <span class="na">borderWidth</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">border</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="na">borderColor</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">border</span><span class="p">.</span><span class="nx">color</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="c1">// Text content (simplified)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">textContent</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">operations</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">fillText</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">domNode</span><span class="p">.</span><span class="nx">textContent</span><span class="p">,</span>
        <span class="na">x</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingLeft</span><span class="p">,</span>
        <span class="na">y</span><span class="p">:</span> <span class="nx">box</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">box</span><span class="p">.</span><span class="nx">paddingTop</span><span class="p">,</span>
        <span class="na">color</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">color</span>
      <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="c1">// Process children that belong to the same layer</span>
    <span class="nx">paintNode</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">layerId</span> <span class="o">===</span> <span class="nx">paintNode</span><span class="p">.</span><span class="nx">layerId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">collectPaintOperations</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">operations</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="nx">executePaintOperation</span><span class="p">(</span><span class="nx">operation</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simulate paint operation execution time</span>
    <span class="kd">const</span> <span class="nx">complexity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculatePaintComplexity</span><span class="p">(</span><span class="nx">operation</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">executionTime</span> <span class="o">=</span> <span class="nx">complexity</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// Simulate time based on complexity</span>
    
    <span class="c1">// In a real browser, this would involve actual graphics APIs</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  üéØ </span><span class="p">${</span><span class="nx">operation</span><span class="p">.</span><span class="nx">type</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">executionTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms)`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">calculatePaintComplexity</span><span class="p">(</span><span class="nx">operation</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">operation</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">fillRect</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">strokeRect</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">operation</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">*</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">borderWidth</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
      <span class="k">case</span> <span class="dl">'</span><span class="s1">fillText</span><span class="dl">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">operation</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1">// Composite layers</span>
  <span class="nx">composite</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üîß Starting composite phase...</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
    
    <span class="c1">// Sort layers by z-index and document order</span>
    <span class="kd">const</span> <span class="nx">sortedLayers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortLayersForComposite</span><span class="p">();</span>
    
    <span class="c1">// Composite layers</span>
    <span class="nx">sortedLayers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">layer</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">compositeLayer</span><span class="p">(</span><span class="nx">layer</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">compositeTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`‚úÖ Composite completed in </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">compositeTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">sortLayersForComposite</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">slice</span><span class="p">().</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">aZIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">bZIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">paintNode</span><span class="p">.</span><span class="nx">layoutNode</span><span class="p">.</span><span class="nx">computedStyle</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">aZIndex</span> <span class="o">!==</span> <span class="nx">bZIndex</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">aZIndex</span> <span class="o">-</span> <span class="nx">bZIndex</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="c1">// Fall back to document order</span>
      <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="nx">compositeLayer</span><span class="p">(</span><span class="nx">layer</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">isGPULayer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">isGPULayer</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">processingType</span> <span class="o">=</span> <span class="nx">isGPULayer</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">GPU</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">CPU</span><span class="dl">'</span><span class="p">;</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üîÑ Compositing layer </span><span class="p">${</span><span class="nx">layer</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">processingType</span><span class="p">}</span><span class="s2">)`</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">isGPULayer</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">compositeOnGPU</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">compositeOnCPU</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">compositeOnGPU</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simulate GPU compositing</span>
    <span class="kd">const</span> <span class="nx">operations</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">paintOperations</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  ‚ö° GPU compositing </span><span class="p">${</span><span class="nx">operations</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> operations`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">compositeOnCPU</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Simulate CPU compositing</span>
    <span class="kd">const</span> <span class="nx">operations</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">paintOperations</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  üñ•Ô∏è  CPU compositing </span><span class="p">${</span><span class="nx">operations</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> operations`</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="c1">// Performance analysis</span>
  <span class="nx">analyzeRenderingPerformance</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">totalRenderTime</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compositeTime</span><span class="p">;</span>
    
    <span class="kd">const</span> <span class="nx">analysis</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">paintTime</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">,</span>
      <span class="na">compositeTime</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">compositeTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">,</span>
      <span class="na">totalRenderTime</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">totalRenderTime</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2">ms`</span><span class="p">,</span>
      <span class="na">layerCount</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">gpuLayers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">isGPULayer</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">cpuLayers</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">l</span><span class="p">.</span><span class="nx">isGPULayer</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">performance</span><span class="p">:</span> <span class="nx">totalRenderTime</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Good</span><span class="dl">'</span> <span class="p">:</span> <span class="nx">totalRenderTime</span> <span class="o">&lt;</span> <span class="mi">32</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Warning</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Poor</span><span class="dl">'</span>
    <span class="p">};</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üìä Rendering Performance Analysis:</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">analysis</span><span class="p">);</span>
    
    <span class="c1">// Recommendations</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">analysis</span><span class="p">.</span><span class="nx">layerCount</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö†Ô∏è  High layer count detected. Consider reducing compositing layers.</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paintTime</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö†Ô∏è  Paint time is high. Consider optimizing paint operations.</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">totalRenderTime</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö†Ô∏è  Total render time exceeds 16ms. May cause frame drops.</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">analysis</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-performance-optimization-techniques">üöÄ Performance Optimization Techniques</h2>

<h3 id="1-critical-resource-prioritization">1. Critical Resource Prioritization</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="rouge-code"><pre><span class="c1">// Resource priority optimization</span>
<span class="kd">class</span> <span class="nx">ResourcePriority</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">optimizeResourceLoading</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Critical CSS inlining</span>
    <span class="kd">const</span> <span class="nx">criticalCSS</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">extractCriticalCSS</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inlineCriticalCSS</span><span class="p">(</span><span class="nx">criticalCSS</span><span class="p">);</span>
    
    <span class="c1">// Preload critical resources</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">preloadCriticalResources</span><span class="p">();</span>
    
    <span class="c1">// Defer non-critical resources</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">deferNonCriticalResources</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">extractCriticalCSS</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">aboveFoldElements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">criticalRules</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">stylesheet</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">rule</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isRuleCritical</span><span class="p">(</span><span class="nx">rule</span><span class="p">,</span> <span class="nx">aboveFoldElements</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">criticalRules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">cssText</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cannot access stylesheet:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">criticalRules</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">isRuleCritical</span><span class="p">(</span><span class="nx">rule</span><span class="p">,</span> <span class="nx">elements</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="nx">CSSRule</span><span class="p">.</span><span class="nx">STYLE_RULE</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">elements</span><span class="p">).</span><span class="nx">some</span><span class="p">(</span><span class="nx">el</span> <span class="o">=&gt;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">selectorText</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">preloadCriticalResources</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">criticalResources</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/critical-font.woff2</span><span class="dl">'</span><span class="p">,</span> <span class="na">as</span><span class="p">:</span> <span class="dl">'</span><span class="s1">font</span><span class="dl">'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">font/woff2</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/hero-image.jpg</span><span class="dl">'</span><span class="p">,</span> <span class="na">as</span><span class="p">:</span> <span class="dl">'</span><span class="s1">image</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/critical-script.js</span><span class="dl">'</span><span class="p">,</span> <span class="na">as</span><span class="p">:</span> <span class="dl">'</span><span class="s1">script</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">];</span>
    
    <span class="nx">criticalResources</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">resource</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">link</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">preload</span><span class="dl">'</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="k">as</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">.</span><span class="k">as</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="nx">link</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="k">as</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">font</span><span class="dl">'</span><span class="p">)</span> <span class="nx">link</span><span class="p">.</span><span class="nx">crossOrigin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">anonymous</span><span class="dl">'</span><span class="p">;</span>
      
      <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">deferNonCriticalResources</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Defer non-critical CSS</span>
    <span class="kd">const</span> <span class="nx">nonCriticalCSS</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">link[rel="stylesheet"]:not([data-critical])</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">nonCriticalCSS</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">link</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">media</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">print</span><span class="dl">'</span><span class="p">;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">link</span><span class="p">.</span><span class="nx">media</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">;</span> <span class="p">};</span>
    <span class="p">});</span>
    
    <span class="c1">// Lazy load non-critical scripts</span>
    <span class="kd">const</span> <span class="nx">nonCriticalScripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">script[data-defer]</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">nonCriticalScripts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">script</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">script</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-layout-optimization">2. Layout Optimization</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td><td class="rouge-code"><pre><span class="c1">// Layout optimization utilities</span>
<span class="kd">class</span> <span class="nx">LayoutOptimizer</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">measureLayoutShift</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">clsValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">clsEntries</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">entryList</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">entryList</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">.</span><span class="nx">hadRecentInput</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">clsValue</span> <span class="o">+=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
          <span class="nx">clsEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">layout-shift</span><span class="dl">'</span><span class="p">,</span> <span class="na">buffered</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cumulative Layout Shift:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">clsValue</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLS Entries:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">clsEntries</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">clsValue</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö†Ô∏è  High CLS detected! Consider fixing layout shifts.</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">analyzeLayoutShifts</span><span class="p">(</span><span class="nx">clsEntries</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">analyzeLayoutShifts</span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Layout Shift </span><span class="p">${</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">:`</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Value: </span><span class="p">${</span><span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Time: </span><span class="p">${</span><span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">}</span><span class="s2">ms`</span><span class="p">);</span>
      
      <span class="nx">entry</span><span class="p">.</span><span class="nx">sources</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">source</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Affected element:`</span><span class="p">,</span> <span class="nx">source</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Previous rect:`</span><span class="p">,</span> <span class="nx">source</span><span class="p">.</span><span class="nx">previousRect</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  Current rect:`</span><span class="p">,</span> <span class="nx">source</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">preventLayoutShifts</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Reserve space for images</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reserveImageSpace</span><span class="p">();</span>
    
    <span class="c1">// Set font display swap</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">optimizeFontLoading</span><span class="p">();</span>
    
    <span class="c1">// Prevent ad-related shifts</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reserveAdSpace</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">reserveImageSpace</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">img[data-src]</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">images</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">img</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">img</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">aspectRatio</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">width</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">img</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&amp;&amp;</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">img</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">aspectRatio</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2"> / </span><span class="p">${</span><span class="nx">height</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">optimizeFontLoading</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">fontFaces</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">fonts</span><span class="p">;</span>
    
    <span class="nx">fontFaces</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">font</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">font</span><span class="p">.</span><span class="nx">display</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">swap</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`Font </span><span class="p">${</span><span class="nx">font</span><span class="p">.</span><span class="nx">family</span><span class="p">}</span><span class="s2"> should use font-display: swap`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-interview-questions-and-scenarios">üß† Interview Questions and Scenarios</h2>

<h3 id="1-performance-debugging">1. Performance Debugging</h3>

<p><strong>Question</strong>: ‚ÄúThe page is slow to load. How would you debug it?‚Äù</p>

<p><strong>Answer Framework</strong>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">PerformanceDebugger</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">debugSlowPage</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">üîç Starting performance debugging...</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// 1. Check Core Web Vitals</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">measureCoreWebVitals</span><span class="p">();</span>
    
    <span class="c1">// 2. Analyze network waterfall</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">analyzeNetworkWaterfall</span><span class="p">();</span>
    
    <span class="c1">// 3. Check rendering performance</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">analyzeRenderingPerformance</span><span class="p">();</span>
    
    <span class="c1">// 4. Identify JavaScript bottlenecks</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">analyzeJavaScriptPerformance</span><span class="p">();</span>
    
    <span class="c1">// 5. Check memory usage</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">analyzeMemoryUsage</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">measureCoreWebVitals</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// LCP (Largest Contentful Paint)</span>
    <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">entryList</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">entryList</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">lastEntry</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">entries</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">LCP:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">lastEntry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">observe</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">largest-contentful-paint</span><span class="dl">'</span><span class="p">,</span> <span class="na">buffered</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    
    <span class="c1">// FID (First Input Delay)</span>
    <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">entryList</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">entryList</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FID:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">processingStart</span> <span class="o">-</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">startTime</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}).</span><span class="nx">observe</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">first-input</span><span class="dl">'</span><span class="p">,</span> <span class="na">buffered</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    
    <span class="c1">// CLS (Cumulative Layout Shift)</span>
    <span class="nx">LayoutOptimizer</span><span class="p">.</span><span class="nx">measureLayoutShift</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">analyzeNetworkWaterfall</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">resources</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="c1">// Find slow resources</span>
    <span class="kd">const</span> <span class="nx">slowResources</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">slowResources</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Slow resources detected:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">slowResources</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// Check for render-blocking resources</span>
    <span class="kd">const</span> <span class="nx">renderBlocking</span> <span class="o">=</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> 
      <span class="nx">r</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">.css</span><span class="dl">'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">startTime</span> <span class="o">&lt;</span> <span class="mi">1000</span>
    <span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">renderBlocking</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Too many render-blocking CSS files:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">renderBlocking</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">analyzeRenderingPerformance</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Check for expensive layout operations</span>
    <span class="kd">const</span> <span class="nx">measureEntries</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="dl">'</span><span class="s1">measure</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">layoutMeasures</span> <span class="o">=</span> <span class="nx">measureEntries</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">m</span> <span class="o">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">));</span>
    
    <span class="nx">layoutMeasures</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">measure</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">measure</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`Expensive layout operation: </span><span class="p">${</span><span class="nx">measure</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">measure</span><span class="p">.</span><span class="nx">duration</span><span class="p">}</span><span class="s2">ms)`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">analyzeJavaScriptPerformance</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Check for long tasks</span>
    <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">entryList</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">entryList</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">`Long task detected: </span><span class="p">${</span><span class="nx">entry</span><span class="p">.</span><span class="nx">duration</span><span class="p">}</span><span class="s2">ms`</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">attribution</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Attribution:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">attribution</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}).</span><span class="nx">observe</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">longtask</span><span class="dl">'</span><span class="p">,</span> <span class="na">buffered</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">analyzeMemoryUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">memory</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">performance</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">memory</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">memoryUsage</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">used</span><span class="p">:</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span> <span class="o">/</span> <span class="mi">1048576</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2"> MB`</span><span class="p">,</span>
        <span class="na">total</span><span class="p">:</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">totalJSHeapSize</span> <span class="o">/</span> <span class="mi">1048576</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2"> MB`</span><span class="p">,</span>
        <span class="na">limit</span><span class="p">:</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">jsHeapSizeLimit</span> <span class="o">/</span> <span class="mi">1048576</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="s2"> MB`</span>
      <span class="p">};</span>
      
      <span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">memoryUsage</span><span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">memory</span><span class="p">.</span><span class="nx">usedJSHeapSize</span> <span class="o">/</span> <span class="nx">memory</span><span class="p">.</span><span class="nx">jsHeapSizeLimit</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚ö†Ô∏è  High memory usage detected!</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-rendering-pipeline-questions">2. Rendering Pipeline Questions</h3>

<p><strong>Question</strong>: ‚ÄúWhat happens when you change a CSS property?‚Äù</p>

<p><strong>Answer</strong>: Different CSS properties trigger different stages of the rendering pipeline:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">RenderingPipelineAnalyzer</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">analyzeCSSPropertyImpact</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">propertyImpacts</span> <span class="o">=</span> <span class="p">{</span>
      <span class="c1">// Layout-triggering properties</span>
      <span class="dl">'</span><span class="s1">width</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">padding</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">margin</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">display</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">position</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">float</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">clear</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      
      <span class="c1">// Paint-triggering properties</span>
      <span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">background</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">border</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">box-shadow</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">border-radius</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">visibility</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      
      <span class="c1">// Composite-only properties</span>
      <span class="dl">'</span><span class="s1">transform</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">opacity</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">filter</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">],</span>
      <span class="dl">'</span><span class="s1">will-change</span><span class="dl">'</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">};</span>
    
    <span class="kd">const</span> <span class="nx">impact</span> <span class="o">=</span> <span class="nx">propertyImpacts</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">||</span> <span class="p">[</span><span class="dl">'</span><span class="s1">unknown</span><span class="dl">'</span><span class="p">];</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üéØ Changing </span><span class="p">${</span><span class="nx">property</span><span class="p">}</span><span class="s2"> will trigger:`</span><span class="p">,</span> <span class="nx">impact</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">performance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPerformanceRating</span><span class="p">(</span><span class="nx">impact</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`üìä Performance impact: </span><span class="p">${</span><span class="nx">performance</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="p">{</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">impact</span><span class="p">,</span> <span class="nx">performance</span> <span class="p">};</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">getPerformanceRating</span><span class="p">(</span><span class="nx">impact</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">impact</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">layout</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">High (Avoid in animations)</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">impact</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">paint</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">Medium (Use sparingly)</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">impact</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">composite</span><span class="dl">'</span><span class="p">))</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">Low (Good for animations)</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">Unknown</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">static</span> <span class="nx">demonstrateOptimalAnimations</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">‚úÖ Optimal CSS properties for animations:</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">optimalProperties</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">transform: translateX(100px)</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">transform: scale(1.2)</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">transform: rotate(45deg)</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">opacity: 0.5</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">filter: blur(5px)</span><span class="dl">'</span>
    <span class="p">];</span>
    
    <span class="nx">optimalProperties</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">prop</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  </span><span class="p">${</span><span class="nx">prop</span><span class="p">}</span><span class="s2"> - Composite only`</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="s1">‚ùå Avoid these properties in animations:</span><span class="dl">'</span><span class="p">);</span>
    
    <span class="kd">const</span> <span class="nx">avoidProperties</span> <span class="o">=</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">width/height - Triggers layout</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">padding/margin - Triggers layout</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">top/left - Triggers layout</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">background-color - Triggers paint</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">border-width - Triggers layout</span><span class="dl">'</span>
    <span class="p">];</span>
    
    <span class="nx">avoidProperties</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">prop</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`  </span><span class="p">${</span><span class="nx">prop</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This comprehensive guide provides deep insights into browser architecture and rendering pipeline, essential knowledge for frontend interviews at big tech companies. The practical examples and performance debugging techniques demonstrate real-world application of these concepts.</p>

        </div>
    </article>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Study Resources</h3>
                    <p>Comprehensive collection of frontend interview questions, coding challenges, and system design problems.</p>
                </div>
                <div class="footer-section">
                    <h3>Progress Tracking</h3>
                    <p>Monitor your learning journey with detailed progress indicators and completion status.</p>
                </div>
                <div class="footer-section">
                    <h3>Big Tech Ready</h3>
                    <p>Curated content specifically designed for interviews at Google, Meta, Amazon, Apple, and Netflix.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Frontend Interview Hub. Built for aspiring frontend engineers.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/assets/js/main.js"></script>
</body>
</html>